<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="../../../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="../../../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="../../../../css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="../../../../images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="../../../../images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="../../../../images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="../../../../images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="NodeJS," />










<meta name="description" content="小伙伴们最好同时学习一些http、服务器、linux的知识哟  补充 环境变量cmd:sysdm.cpl检测PATH环境变量是否配置了Node.js，点击开始=》运行=》输入”cmd” =&amp;gt; 输入命令”path”  常用指令ls 查看md 目录名 创建目录rd(rmdir) 目录名 删除目录rd /s/q 目录名 安静删除目录及子目录echo on &amp;gt; 文件名 创建文件echo 内容">
<meta name="keywords" content="NodeJS">
<meta property="og:type" content="article">
<meta property="og:title" content="Node知识点归纳整理">
<meta property="og:url" content="http://www.needqq.com/2018/03/19/Node0/index.html">
<meta property="og:site_name" content="Majun">
<meta property="og:description" content="小伙伴们最好同时学习一些http、服务器、linux的知识哟  补充 环境变量cmd:sysdm.cpl检测PATH环境变量是否配置了Node.js，点击开始=》运行=》输入”cmd” =&amp;gt; 输入命令”path”  常用指令ls 查看md 目录名 创建目录rd(rmdir) 目录名 删除目录rd /s/q 目录名 安静删除目录及子目录echo on &amp;gt; 文件名 创建文件echo 内容">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-03-19T07:58:46.548Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Node知识点归纳整理">
<meta name="twitter:description" content="小伙伴们最好同时学习一些http、服务器、linux的知识哟  补充 环境变量cmd:sysdm.cpl检测PATH环境变量是否配置了Node.js，点击开始=》运行=》输入”cmd” =&amp;gt; 输入命令”path”  常用指令ls 查看md 目录名 创建目录rd(rmdir) 目录名 删除目录rd /s/q 目录名 安静删除目录及子目录echo on &amp;gt; 文件名 创建文件echo 内容">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.needqq.com/2018/03/19/Node0/"/>





  <title>Node知识点归纳整理 | Majun</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Majun</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.needqq.com">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Majun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="../../../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Majun">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Node知识点归纳整理</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-19T15:40:27+08:00">
                2018-03-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="../../../../categories/NodeJS/" itemprop="url" rel="index">
                    <span itemprop="name">NodeJS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>小伙伴们最好同时学习一些http、服务器、linux的知识哟</p>
</blockquote>
<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><ol>
<li><p>环境变量<br><code>cmd:sysdm.cpl</code><br>检测PATH环境变量是否配置了Node.js，点击开始=》运行=》输入”cmd” =&gt; 输入命令”path”</p>
</li>
<li><p>常用指令<br><code>ls</code> 查看<br><code>md 目录名</code> 创建目录<br><code>rd(rmdir) 目录名</code> 删除目录<br><code>rd /s/q 目录名</code> 安静删除目录及子目录<br><code>echo on &gt; 文件名</code> 创建文件<br><code>echo 内容 &gt; 文件名</code> 设置文件内容<br><code>echo 内容 &gt;&gt; 文件名</code> 添加文件内容<br><code>rm 文件名</code> 删除文件<br><code>cat 文件名</code> 查看文件内容<br><code>cat &gt; 文件名</code> 进入文件内容编辑<br><code>cat &gt;&gt; 文件名</code> 进入文件内容添加编辑</p>
</li>
<li><p>node多版本管理 nvm<br><code>nvm version</code><br><code>nvm list</code> 查看nvm里node版本的列表<br><code>nvm user 版本号</code> 切换nvm里node的版本</p>
</li>
<li><p>REPL 命令行方式<br>read-eval-print-loop 读取代码-执行-打印结果-循环这个过程<br>在REPL环境中，<code>_</code>表示最后一次执行结果; <code>.exit</code>可以退出REPL环境<br><code>node</code> 进入REPL环境<br><code>node js文件</code> 通过js文件执行</p>
</li>
<li><p>nodejs跨域<br>express配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.all(&apos;/test&apos;, function(req, res, next) &#123;</span><br><span class="line">    res.header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);</span><br><span class="line">    res.header(&apos;Access-Control-Allow-Methods&apos;, &apos;PUT, GET, POST, DELETE, OPTIONS&apos;);</span><br><span class="line">    res.header(&quot;Access-Control-Allow-Headers&quot;, &quot;X-Requested-With&quot;);</span><br><span class="line">    res.header(&apos;Access-Control-Allow-Headers&apos;, &apos;Content-Type&apos;);</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>nginx配置<br>然而添加了这些之后，仍然不好使。查了查，可能是要在nginx上也作设置，在nginx相应路径添加如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location ^~ /test &#123;</span><br><span class="line">    add_header &apos;Access-Control-Allow-Origin&apos; &apos;*&apos;;</span><br><span class="line">    add_header &apos;Access-Control-Allow-Credentials&apos; &apos;true&apos;;</span><br><span class="line">    add_header &apos;Access-Control-Allow-Methods&apos; &apos;OPTION, POST, GET&apos;;</span><br><span class="line">    add_header &apos;Access-Control-Allow-Headers&apos; &apos;X-Requested-With, Content-Type&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>之后重新加载nginx配置即可，大功告成。</p>
<h3 id="全局对象global"><a href="#全局对象global" class="headerlink" title="全局对象global"></a>全局对象global</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// __filename包含文件名称的全路径</span><br><span class="line">console.log(__filename);</span><br><span class="line">// __dirname文件的路径（不包含文件名称）</span><br><span class="line">console.log(__dirname);</span><br><span class="line">// 定时函数，用法与浏览器中的定时函数类似</span><br><span class="line">var timer = setTimeout(function()&#123;</span><br><span class="line">    console.log(123);</span><br><span class="line">&#125;,1000);</span><br><span class="line">// 在Node.js中没有window对象，但是有一个类似的对象global，访问全局成员的时候可以省略global</span><br><span class="line">global.console.log(123456);</span><br><span class="line">// process.argv,argv是一个数组，默认情况下，前两项数据分别是：Node.js环境的路径</span><br><span class="line">// 当前执行的js文件的全路径,从第三个参数开始表示命令行参数</span><br><span class="line">console.log(process.argv);</span><br><span class="line">// process.arch打印当前系统的架构（64位或者32位）</span><br><span class="line">console.log(process.arch);</span><br></pre></td></tr></table></figure>
<h3 id="buffer"><a href="#buffer" class="headerlink" title="buffer"></a>buffer</h3><blockquote>
<p>Buffer对象是Node处理二进制数据的一个接口。它是Node原生提供的全局对象，可以直接使用，不需要require(‘buffer’)</p>
</blockquote>
<p>Buffer的基本操作 : (Buffer本质上就是字节数组)<br>    1、构造方法（类）(不常用)<br>    2、静态方法<br>    3、实例方法</p>
<ul>
<li>实例化<ul>
<li>Buffer.from(array)</li>
<li>Buffer.from(string)</li>
<li>Buffer.alloc(size)</li>
</ul>
</li>
<li>功能方法<ul>
<li>Buffer.isEncoding() 判断是否支持该编码</li>
<li>Buffer.isBuffer() 判断是否为Buffer</li>
<li>Buffer.byteLength() 返回指定编码的字节长度，默认utf8</li>
<li>Buffer.concat() 将一组Buffer对象合并为一个Buffer对象</li>
</ul>
</li>
<li>实例方法<ul>
<li>write() 向buffer对象中写入内容</li>
<li>slice() 截取新的buffer对象</li>
<li>toString() 把buf对象转成字符串</li>
<li>toJson() 把buf对象转成json形式的字符串 (toJSON方法不需要显式调用，当JSON.stringify方法调用的时候会自动调用toJSON方法)</li>
</ul>
</li>
</ul>
<h2 id="核心模块API"><a href="#核心模块API" class="headerlink" title="核心模块API"></a>核心模块API</h2><h3 id="路径操作"><a href="#路径操作" class="headerlink" title="路径操作"></a>路径操作</h3><ul>
<li>路径基本操作API<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// path.basename()获取路径的最后一部分</span></span><br><span class="line"><span class="comment">// console.log(path.basename('/foo/bar/baz/asdf/quux.html'));</span></span><br><span class="line"><span class="comment">// console.log(path.basename('/foo/bar/baz/asdf/quux.html', '.html'));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// path.dirnam()获取路径</span></span><br><span class="line"><span class="comment">// console.log(__dirname);</span></span><br><span class="line"><span class="comment">// console.log(path.dirname('/abc/qqq/www/abc'));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// path.extname()获取扩展名称</span></span><br><span class="line"><span class="comment">// console.log(path.extname('index.html'));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// path.format(),mpath.parse()路径的格式化处理</span></span><br><span class="line"><span class="comment">// path.format() obj-&gt;string</span></span><br><span class="line"><span class="comment">// path.parse()  string-&gt;obj</span></span><br><span class="line"><span class="comment">// let obj = path.parse(__filename);</span></span><br><span class="line"><span class="comment">// console.log(obj.base);</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#123; root: 'E:\\', 文件的跟路径</span></span><br><span class="line"><span class="comment">  dir: 'E:\\node\\day02\\02-code',文件的全路径</span></span><br><span class="line"><span class="comment">  base: '02.js',文件的名称</span></span><br><span class="line"><span class="comment">  ext: '.js',扩展名</span></span><br><span class="line"><span class="comment">  name: '02' 文件名称</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// let objpath = &#123;</span></span><br><span class="line"><span class="comment">//     root : 'd:\\',</span></span><br><span class="line"><span class="comment">//     dir : 'd:\\qqq\\www',</span></span><br><span class="line"><span class="comment">//     base : 'abc.txt',</span></span><br><span class="line"><span class="comment">//     ext : '.txt',</span></span><br><span class="line"><span class="comment">//     name : 'abc'</span></span><br><span class="line"><span class="comment">// &#125;;</span></span><br><span class="line"><span class="comment">// let strpath = path.format(objpath);</span></span><br><span class="line"><span class="comment">// console.log(strpath);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// path.isAbsolute()判断是否为绝对路径</span></span><br><span class="line"><span class="comment">// console.log(path.isAbsolute('/foo/bar'));</span></span><br><span class="line"><span class="comment">// console.log(path.isAbsolute('C:/foo/..'));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// path.join()拼接路径（..表示上层路径；.表示当前路径）,在连接路径的时候会格式化路径</span></span><br><span class="line"><span class="comment">// console.log(path.join('/foo', 'bar', 'baz/asdf', 'quux', '../../'));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// path.normalize()规范化路径</span></span><br><span class="line"><span class="comment">// console.log(path.normalize('/foo/bar//baz/asdf/quux/..'));</span></span><br><span class="line"><span class="comment">// console.log(path.normalize('C:\\temp\\\\foo\\bar\\..\\'));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// path.relative()计算相对路径</span></span><br><span class="line"><span class="comment">// console.log(path.relative('/data/orandea/test/aaa', '/data/orandea/impl/bbb'));</span></span><br><span class="line"><span class="comment">// console.log(path.relative('C:\\orandea\\test\\aaa', 'C:\\orandea\\impl\\bbb'));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// path.resolve解析路径()</span></span><br><span class="line"><span class="comment">// console.log(path.resolve('wwwroot', 'static_files/png/', '../gif/image.gif'));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 两个特殊属性path.delimiter,path.sep</span></span><br><span class="line"><span class="comment">// console.log(path.delimiter);//表示路径分隔符（windows是\ Linux是/）</span></span><br><span class="line"><span class="comment">// console.log(path.sep);//环境变量分隔符(windows中使用; linux中使用:)</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>###异步I/O input/output<br>1、文件操作<br>2、网络操作</p>
<p>在浏览器中也存在异步操作：<br>1、定时任务<br>2、事件处理<br>3、Ajax回调处理</p>
<p>js的运行是单线程的引入事件队列机制,Node.js中的事件模型与浏览器中的事件模型类似–单线程+事件队列</p>
<p>Node.js中异步执行的任务：<br>1、文件I/O<br>2、网络I/O</p>
<p>基于回调函数的编码风格</p>
<h3 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h3><ul>
<li>文件信息获取</li>
<li>读文件操作</li>
<li>写文件操作</li>
<li>目录操作</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    文件操作-查看文件状态</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">fs.stat(<span class="string">'./abc'</span>,(err,stat) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 一般回调函数的第一个参数是错误对象，如果err为null,表示没有错误，否则表示报错了</span></span><br><span class="line">    <span class="comment">// if(err) return;</span></span><br><span class="line">    <span class="comment">// if(stat.isFile())&#123;</span></span><br><span class="line">    <span class="comment">//     console.log('文件');</span></span><br><span class="line">    <span class="comment">// &#125;else if(stat.isDirectory())&#123;</span></span><br><span class="line">    <span class="comment">//     console.log('目录');</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// console.log(stat);</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    atime 文件访问时间</span></span><br><span class="line"><span class="comment">    ctime 文件的状态信息发生变化的时间（比如文件的权限）</span></span><br><span class="line"><span class="comment">    mtime 文件数据发生变化的时间</span></span><br><span class="line"><span class="comment">    birthtime 文件创建的时间</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 同步操作</span></span><br><span class="line"><span class="comment">// let ret = fs.statSync('./data.txt');</span></span><br><span class="line"><span class="comment">// console.log(ret);</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    读文件操作</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">let</span> strpath = path.join(__dirname,<span class="string">'data.txt'</span>);</span><br><span class="line"></span><br><span class="line">fs.readFile(strpath,(err,data)=&gt;&#123;</span><br><span class="line">    <span class="comment">// if(err) return;</span></span><br><span class="line">    <span class="built_in">console</span>.log(data.toString());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果有第二个参数并且是编码，那么回调函数获取到的数据就是字符串</span></span><br><span class="line"><span class="comment">// 如果没有第二个参数，那么得到的就是Buffer实例对象</span></span><br><span class="line"><span class="comment">// fs.readFile(strpath,'utf8',(err,data)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//     // if(err) return;</span></span><br><span class="line"><span class="comment">//     console.log(data);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步操作</span></span><br><span class="line"><span class="comment">// let ret = fs.readFileSync(strpath,'utf8');</span></span><br><span class="line"><span class="comment">// console.log(ret);</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    写文件操作</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">let</span> strpath = path.join(__dirname,<span class="string">'data.txt'</span>);</span><br><span class="line"></span><br><span class="line">fs.writeFile(strpath,<span class="string">'hello nihao'</span>,<span class="string">'utf8'</span>,(err)=&gt;&#123;</span><br><span class="line">    <span class="comment">// if(!err)&#123;</span></span><br><span class="line">    <span class="comment">//     console.log('文件写入成功');</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// let buf = Buffer.from('hi');</span></span><br><span class="line"><span class="comment">// fs.writeFile(strpath,buf,'utf8',(err)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//     if(!err)&#123;</span></span><br><span class="line"><span class="comment">//         console.log('文件写入成功');</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步操作</span></span><br><span class="line"><span class="comment">// fs.writeFileSync(strpath,'tom and jerry');</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    大文件操作（流式操作）</span></span><br><span class="line"><span class="comment">    fs.createReadStream(path[, options])</span></span><br><span class="line"><span class="comment">    fs.createWriteStream(path[, options])</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> spath = path.join(__dirname,<span class="string">'../03-source'</span>,<span class="string">'file.zip'</span>);</span><br><span class="line"><span class="keyword">let</span> dpath = path.join(<span class="string">'C:\\Users\\www\\Desktop'</span>,<span class="string">'file.zip'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> readStream = fs.createReadStream(spath);</span><br><span class="line"><span class="keyword">let</span> writeStream = fs.createWriteStream(dpath);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基于事件的处理方式</span></span><br><span class="line"><span class="comment">// let num = 1;</span></span><br><span class="line">readStream.on(<span class="string">'data'</span>,(chunk)=&gt;&#123;</span><br><span class="line">    <span class="comment">// num++;</span></span><br><span class="line">    writeStream.write(chunk);</span><br><span class="line">&#125;);</span><br><span class="line">readStream.on(<span class="string">'end'</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'文件处理完成'</span>+num);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// pipe的作用直接把输入流和输出流</span></span><br><span class="line">readStream.pipe(writeStream);</span><br><span class="line"></span><br><span class="line">fs.createReadStream(spath).pipe(fs.createWriteStream(dpath));</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    目录操作</span></span><br><span class="line"><span class="comment">    1、创建目录</span></span><br><span class="line"><span class="comment">    fs.mkdir(path[, mode], callback)</span></span><br><span class="line"><span class="comment">    fs.mkdirSync(path[, mode])</span></span><br><span class="line"><span class="comment">    2、读取目录</span></span><br><span class="line"><span class="comment">    fs.readdir(path[, options], callback)</span></span><br><span class="line"><span class="comment">    fs.readdirSync(path[, options])</span></span><br><span class="line"><span class="comment">    3、删除目录</span></span><br><span class="line"><span class="comment">    fs.rmdir(path, callback)</span></span><br><span class="line"><span class="comment">    fs.rmdirSync(path)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="comment">// 创建目录</span></span><br><span class="line">fs.mkdir(path.join(__dirname,<span class="string">'abc'</span>),(err)=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// fs.mkdirSync(path.join(__dirname,'hello'));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------</span></span><br><span class="line"><span class="comment">// 读取目录</span></span><br><span class="line">fs.readdir(__dirname,(err,files)=&gt;&#123;</span><br><span class="line">    files.forEach(<span class="function">(<span class="params">item,index</span>)=&gt;</span>&#123;</span><br><span class="line">        fs.stat(path.join(__dirname,item),(err,stat)=&gt;&#123;</span><br><span class="line">            <span class="comment">// if(stat.isFile())&#123;</span></span><br><span class="line">            <span class="comment">//     console.log(item,'文件');</span></span><br><span class="line">            <span class="comment">// &#125;else if(stat.isDirectory())&#123;</span></span><br><span class="line">            <span class="comment">//     console.log(item,'目录');</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// let files = fs.readdirSync(__dirname);</span></span><br><span class="line"><span class="comment">// files.forEach((item,index)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//     fs.stat(path.join(__dirname,item),(err,stat)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//         if(stat.isFile())&#123;</span></span><br><span class="line"><span class="comment">//             console.log(item,'文件');</span></span><br><span class="line"><span class="comment">//         &#125;else if(stat.isDirectory())&#123;</span></span><br><span class="line"><span class="comment">//             console.log(item,'目录');</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------------</span></span><br><span class="line"><span class="comment">// 删除目录</span></span><br><span class="line">fs.rmdir(path.join(__dirname,<span class="string">'abc'</span>),(err)=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// fs.rmdirSync(path.join(__dirname,'qqq'));</span></span><br></pre></td></tr></table></figure>
<h2 id="Node-js实现静态网站功能"><a href="#Node-js实现静态网站功能" class="headerlink" title="Node.js实现静态网站功能"></a>Node.js实现静态网站功能</h2><blockquote>
<p>使用http模块初步实现服务器功能<br>实现静态服务器功能</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    初步实现服务器功能</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="comment">// 创建服务器实例对象</span></span><br><span class="line"><span class="keyword">let</span> server = http.createServer();</span><br><span class="line"><span class="comment">// 绑定请求事件</span></span><br><span class="line">server.on(<span class="string">'request'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    res.end(<span class="string">'hello'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 监听端口</span></span><br><span class="line">server.listen(<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// -----------------------------</span></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.end(<span class="string">'ok'</span>);</span><br><span class="line">&#125;).listen(<span class="number">3000</span>,<span class="string">'192.168.0.106'</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    处理请求路径的分发</span></span><br><span class="line"><span class="comment">    1、req对象是Class: http.IncomingMessage的实例对象</span></span><br><span class="line"><span class="comment">    2、res对象是Class: http.ServerResponse的实例对象</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line">http.createServer(<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// req.url可以获取URL中的路径（端口之后部分）</span></span><br><span class="line">    <span class="comment">// res.end(req.url);</span></span><br><span class="line">    <span class="keyword">if</span>(req.url.startsWith(<span class="string">'/index'</span>))&#123;</span><br><span class="line">        <span class="comment">// write向客户端响应内容,可以写多次</span></span><br><span class="line">        res.write(<span class="string">'hello'</span>);</span><br><span class="line">        res.write(<span class="string">'hi'</span>);</span><br><span class="line">        <span class="comment">// end方法用来完成响应，只能执行一次</span></span><br><span class="line">        res.end();</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(req.url.startsWith(<span class="string">'/about'</span>))&#123;</span><br><span class="line">        res.end(<span class="string">'about'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        res.end(<span class="string">'no content'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).listen(<span class="number">3000</span>,<span class="string">'192.168.0.106'</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    响应完整的页面信息</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据路径读取文件的内容，并且响应到浏览器端</span></span><br><span class="line"><span class="keyword">let</span> readFile = <span class="function">(<span class="params">url,res</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.readFile(path.join(__dirname,<span class="string">'www'</span>,url),<span class="string">'utf8'</span>,(err,fileContent)=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            res.end(<span class="string">'server error'</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.end(fileContent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 处理路径的分发</span></span><br><span class="line">    <span class="keyword">if</span>(req.url.startsWith(<span class="string">'/index'</span>))&#123;</span><br><span class="line">        readFile(<span class="string">'index.html'</span>,res);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(req.url.startsWith(<span class="string">'/about'</span>))&#123;</span><br><span class="line">        readFile(<span class="string">'about.html'</span>,res);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(req.url.startsWith(<span class="string">'/list'</span>))&#123;</span><br><span class="line">        readFile(<span class="string">'list.html'</span>,res);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// 设置相应类型和编码</span></span><br><span class="line">        res.writeHead(<span class="number">200</span>,&#123;</span><br><span class="line">            <span class="string">'Content-Type'</span>:<span class="string">'text/plain; charset=utf8'</span></span><br><span class="line">        &#125;);</span><br><span class="line">        res.end(<span class="string">'页面被狗狗叼走了'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).listen(<span class="number">3000</span>,<span class="string">'192.168.0.106'</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    响应完整的页面信息优化</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> mime = <span class="built_in">require</span>(<span class="string">'./mime.json'</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    fs.readFile(path.join(__dirname,<span class="string">'www'</span>,req.url),(err,fileContent)=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="comment">// 没有找到对应文件</span></span><br><span class="line">            res.writeHead(<span class="number">404</span>,&#123;</span><br><span class="line">                <span class="string">'Content-Type'</span>:<span class="string">'text/plain; charset=utf8'</span></span><br><span class="line">            &#125;);</span><br><span class="line">            res.end(<span class="string">'页面被狗狗叼走了'</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">let</span> dtype = <span class="string">'text/html'</span>;</span><br><span class="line">            <span class="comment">// 获取请求文件的后缀</span></span><br><span class="line">            <span class="keyword">let</span> ext = path.extname(req.url);</span><br><span class="line">            <span class="comment">// 如果请求的文件后缀合理，就获取到标准的响应格式</span></span><br><span class="line">            <span class="keyword">if</span>(mime[ext])&#123;</span><br><span class="line">                dtype = mime[ext];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 如果响应的内容是文本，就设置成utf8编码</span></span><br><span class="line">            <span class="keyword">if</span>(dtype.startsWith(<span class="string">'text'</span>))&#123;</span><br><span class="line">                dtype += <span class="string">'; charset=utf8'</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 设置响应头信息</span></span><br><span class="line">            res.writeHead(<span class="number">200</span>,&#123;</span><br><span class="line">                <span class="string">'Content-Type'</span>:dtype</span><br><span class="line">            &#125;);</span><br><span class="line">            res.end(fileContent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;).listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//封装成模块</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> mime = <span class="built_in">require</span>(<span class="string">'./mime.json'</span>);</span><br><span class="line"></span><br><span class="line">exports.staticServer = <span class="function">(<span class="params">req,res,root</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.readFile(path.join(root,req.url),(err,fileContent)=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="comment">// 没有找到对应文件</span></span><br><span class="line">            res.writeHead(<span class="number">404</span>,&#123;</span><br><span class="line">                <span class="string">'Content-Type'</span>:<span class="string">'text/plain; charset=utf8'</span></span><br><span class="line">            &#125;);</span><br><span class="line">            res.end(<span class="string">'页面被狗狗叼走了'</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">let</span> dtype = <span class="string">'text/html'</span>;</span><br><span class="line">            <span class="comment">// 获取请求文件的后缀</span></span><br><span class="line">            <span class="keyword">let</span> ext = path.extname(req.url);</span><br><span class="line">            <span class="comment">// 如果请求的文件后缀合理，就获取到标准的响应格式</span></span><br><span class="line">            <span class="keyword">if</span>(mime[ext])&#123;</span><br><span class="line">                dtype = mime[ext];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 如果响应的内容是文本，就设置成utf8编码</span></span><br><span class="line">            <span class="keyword">if</span>(dtype.startsWith(<span class="string">'text'</span>))&#123;</span><br><span class="line">                dtype += <span class="string">'; charset=utf8'</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 设置响应头信息</span></span><br><span class="line">            res.writeHead(<span class="number">200</span>,&#123;</span><br><span class="line">                <span class="string">'Content-Type'</span>:dtype</span><br><span class="line">            &#125;);</span><br><span class="line">            res.end(fileContent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> ss = <span class="built_in">require</span>(<span class="string">'./06.js'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// ss.staticServer(req,res,path.join(__dirname,'www'));</span></span><br><span class="line">    ss.staticServer(req,res,path.join(<span class="string">'C:\\Users\\www\\Desktop'</span>,<span class="string">'test'</span>));</span><br><span class="line">&#125;).listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running....'</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="参数传递与获取"><a href="#参数传递与获取" class="headerlink" title="参数传递与获取"></a>参数传递与获取</h2><ul>
<li>get参数获取<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    get参数处理-url核心模块</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// const url = require('url');</span></span><br><span class="line"><span class="comment">// parse方法的作用就是把URL字符串转化为对象</span></span><br><span class="line"><span class="comment">// let str = 'http://www.baidu.com/abc/qqq?flag=123&amp;keyword=java';</span></span><br><span class="line"><span class="keyword">let</span> ret = url.parse(str,<span class="literal">true</span>);</span><br><span class="line"><span class="comment">// console.log(ret.query.keyword);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// format的作用就是把对象转化为标准的URL字符串</span></span><br><span class="line"><span class="comment">// let obj = &#123;</span></span><br><span class="line"><span class="comment">//   protocol: 'http:',</span></span><br><span class="line"><span class="comment">//   slashes: true,</span></span><br><span class="line"><span class="comment">//   auth: null,</span></span><br><span class="line"><span class="comment">//   host: 'www.baidu.com',</span></span><br><span class="line"><span class="comment">//   port: null,</span></span><br><span class="line"><span class="comment">//   hostname: 'www.baidu.com',</span></span><br><span class="line"><span class="comment">//   hash: null,</span></span><br><span class="line"><span class="comment">//   search: '?flag=123&amp;keyword=java',</span></span><br><span class="line"><span class="comment">//   query: 'flag=123&amp;keyword=java',</span></span><br><span class="line"><span class="comment">//   pathname: '/abc/qqq',</span></span><br><span class="line"><span class="comment">//   path: '/abc/qqq?flag=123&amp;keyword=java',</span></span><br><span class="line"><span class="comment">//   href: 'http://www.baidu.com/abc/qqq?flag=123&amp;keyword=java' </span></span><br><span class="line"><span class="comment">// &#125;;</span></span><br><span class="line"><span class="keyword">let</span> ret1 = url.format(obj);</span><br><span class="line"><span class="comment">// console.log(ret1);</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    get参数解析</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> obj = url.parse(req.url,<span class="literal">true</span>);</span><br><span class="line">    res.end(obj.query.username + <span class="string">'========='</span> + obj.query.password);</span><br><span class="line">&#125;).listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running....'</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>post参数获取<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    post参数处理</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// parse方法的作用就是把字符串转成对象</span></span><br><span class="line"><span class="comment">// let param = 'username=lisi&amp;password=123';</span></span><br><span class="line"><span class="comment">// let param = 'foo=bar&amp;abc=xyz&amp;abc=123';</span></span><br><span class="line"><span class="keyword">let</span> obj = querystring.parse(param);</span><br><span class="line"><span class="comment">// console.log(obj);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// stringify的作用就是把对象转成字符串</span></span><br><span class="line"><span class="comment">// let obj1 = &#123;</span></span><br><span class="line"><span class="comment">//     flag : '123',</span></span><br><span class="line"><span class="comment">//     abc : ['hello','hi']</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="keyword">let</span> str1 = querystring.stringify(obj1);</span><br><span class="line"><span class="comment">// console.log(str1);</span></span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(req.url.startsWith(<span class="string">'/login'</span>))&#123;</span><br><span class="line">        <span class="keyword">let</span> pdata = <span class="string">''</span>;</span><br><span class="line">        req.on(<span class="string">'data'</span>,(chunk)=&gt;&#123;</span><br><span class="line">            <span class="comment">// 每次获取一部分数据</span></span><br><span class="line">            pdata += chunk;</span><br><span class="line">        &#125;);</span><br><span class="line">        req.on(<span class="string">'end'</span>,()=&gt;&#123;</span><br><span class="line">            <span class="comment">// 这里才能得到完整的数据</span></span><br><span class="line">            <span class="built_in">console</span>.log(pdata);</span><br><span class="line">            <span class="keyword">let</span> obj = querystring.parse(pdata);</span><br><span class="line">            res.end(obj.username+<span class="string">'-----'</span>+obj.password);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    登录验证功能</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"><span class="keyword">const</span> ss = <span class="built_in">require</span>(<span class="string">'./06.js'</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 启动静态资源服务</span></span><br><span class="line">    <span class="keyword">if</span>(req.url.startsWith(<span class="string">'/www'</span>))&#123;</span><br><span class="line">        ss.staticServer(req,res,__dirname);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(req.url);</span><br><span class="line">    <span class="comment">// 动态资源</span></span><br><span class="line">    <span class="keyword">if</span>(req.url.startsWith(<span class="string">'/login'</span>))&#123;</span><br><span class="line">        <span class="comment">// get请求</span></span><br><span class="line">        <span class="keyword">if</span>(req.method == <span class="string">'GET'</span>)&#123;</span><br><span class="line">            <span class="keyword">let</span> param = url.parse(req.url,<span class="literal">true</span>).query;</span><br><span class="line">            <span class="keyword">if</span>(param.username == <span class="string">'admin'</span> &amp;&amp; param.password == <span class="string">'123'</span>)&#123;</span><br><span class="line">                res.end(<span class="string">'get success'</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                res.end(<span class="string">'get failure'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// post请求</span></span><br><span class="line">        <span class="keyword">if</span>(req.method == <span class="string">'POST'</span>)&#123;</span><br><span class="line">            <span class="keyword">let</span> pdata = <span class="string">''</span>;</span><br><span class="line">            req.on(<span class="string">'data'</span>,(chunk)=&gt;&#123;</span><br><span class="line">                pdata += chunk;</span><br><span class="line">            &#125;);</span><br><span class="line">            req.on(<span class="string">'end'</span>,()=&gt;&#123;</span><br><span class="line">                <span class="keyword">let</span> obj = querystring.parse(pdata);</span><br><span class="line">                <span class="keyword">if</span>(obj.username == <span class="string">'admin'</span> &amp;&amp; obj.password == <span class="string">'123'</span>)&#123;</span><br><span class="line">                    res.end(<span class="string">'post success'</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    res.end(<span class="string">'post failure'</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;).listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running....'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://localhost:3000/login"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">        用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="动态网站开发"><a href="#动态网站开发" class="headerlink" title="动态网站开发"></a>动态网站开发</h2><blockquote>
<p>创建服务器实现动态网站效果</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    动态网站开发</span></span><br><span class="line"><span class="comment">    成绩查询功能</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"><span class="keyword">const</span> scoreData = <span class="built_in">require</span>(<span class="string">'./scores.json'</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 路由（请求路径+请求方式）</span></span><br><span class="line">    <span class="keyword">if</span>(req.url.startsWith(<span class="string">'/query'</span>) &amp;&amp; req.method == <span class="string">'GET'</span>)&#123;</span><br><span class="line">        <span class="comment">// 查询成绩的入口地址 /query</span></span><br><span class="line">        fs.readFile(path.join(__dirname,<span class="string">'view'</span>,<span class="string">'index.tpl'</span>),<span class="string">'utf8'</span>,(err,content)=&gt;&#123;</span><br><span class="line">            <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                res.writeHead(<span class="number">500</span>,&#123;</span><br><span class="line">                    <span class="string">'Content-Type'</span>:<span class="string">'text/plain; charset=utf8'</span></span><br><span class="line">                &#125;);</span><br><span class="line">                res.end(<span class="string">'服务器错误，请与管理员联系'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            res.end(content);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(req.url.startsWith(<span class="string">'/score'</span>) &amp;&amp; req.method == <span class="string">'POST'</span>)&#123;</span><br><span class="line">        <span class="comment">// 获取成绩的结果 /score</span></span><br><span class="line">        <span class="keyword">let</span> pdata = <span class="string">''</span>;</span><br><span class="line">        req.on(<span class="string">'data'</span>,(chunk)=&gt;&#123;</span><br><span class="line">            pdata += chunk;</span><br><span class="line">        &#125;);</span><br><span class="line">        req.on(<span class="string">'end'</span>,()=&gt;&#123;</span><br><span class="line">            <span class="keyword">let</span> obj = querystring.parse(pdata);</span><br><span class="line">            <span class="keyword">let</span> result = scoreData[obj.code];</span><br><span class="line">            fs.readFile(path.join(__dirname,<span class="string">'view'</span>,<span class="string">'result.tpl'</span>),<span class="string">'utf8'</span>,(err,content)=&gt;&#123;</span><br><span class="line">                <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                    res.writeHead(<span class="number">500</span>,&#123;</span><br><span class="line">                        <span class="string">'Content-Type'</span>:<span class="string">'text/plain; charset=utf8'</span></span><br><span class="line">                    &#125;);</span><br><span class="line">                    res.end(<span class="string">'服务器错误，请与管理员联系'</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 返回内容之前要进行数据渲染</span></span><br><span class="line">                content = content.replace(<span class="string">'$$chinese$$'</span>,result.chinese);</span><br><span class="line">                content = content.replace(<span class="string">'$$math$$'</span>,result.math);</span><br><span class="line">                content = content.replace(<span class="string">'$$english$$'</span>,result.english);</span><br><span class="line">                content = content.replace(<span class="string">'$$summary$$'</span>,result.summary);</span><br><span class="line">                res.end(content);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running....'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- view/index --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>查询成绩<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://localhost:3000/score"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">        请输入考号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"code"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"查询"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- view/result --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>成绩结果<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>语文：$$chinese$$<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>数学：$$math$$<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>外语：$$english$$<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>综合：$$summary$$<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"no123"</span> : &#123;</span><br><span class="line">        <span class="attr">"chinese"</span> : <span class="string">"100"</span>,</span><br><span class="line">        <span class="attr">"math"</span> : <span class="string">"140"</span>,</span><br><span class="line">        <span class="attr">"english"</span> : <span class="string">"149"</span>,</span><br><span class="line">        <span class="attr">"summary"</span> : <span class="string">"289"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"no124"</span> : &#123;</span><br><span class="line">        <span class="attr">"chinese"</span> : <span class="string">"120"</span>,</span><br><span class="line">        <span class="attr">"math"</span> : <span class="string">"120"</span>,</span><br><span class="line">        <span class="attr">"english"</span> : <span class="string">"119"</span>,</span><br><span class="line">        <span class="attr">"summary"</span> : <span class="string">"239"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"no125"</span> : &#123;</span><br><span class="line">        <span class="attr">"chinese"</span> : <span class="string">"130"</span>,</span><br><span class="line">        <span class="attr">"math"</span> : <span class="string">"110"</span>,</span><br><span class="line">        <span class="attr">"english"</span> : <span class="string">"139"</span>,</span><br><span class="line">        <span class="attr">"summary"</span> : <span class="string">"269"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="模板引擎"><a href="#模板引擎" class="headerlink" title="模板引擎"></a>模板引擎</h2><blockquote>
<p>理解模板引擎本质<br>引擎基本使用</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    模板引擎</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">let</span> template = <span class="built_in">require</span>(<span class="string">'art-template'</span>);</span><br><span class="line"><span class="comment">// let html = template(__dirname + '/mytpl.art', &#123;</span></span><br><span class="line"><span class="comment">//     user: &#123;</span></span><br><span class="line"><span class="comment">//         name: 'lisi'</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"><span class="comment">// console.log(html);</span></span><br><span class="line"><span class="comment">// ----------------------------------</span></span><br><span class="line"><span class="comment">// let tpl = '&lt;ul&gt;&#123;&#123;each list as value&#125;&#125;&lt;li&gt;&#123;&#123;value&#125;&#125;&lt;/li&gt;&#123;&#123;/each&#125;&#125;&lt;/ul&gt;';</span></span><br><span class="line"><span class="comment">// let render = template.compile(tpl);</span></span><br><span class="line"><span class="comment">// let ret = render(&#123;</span></span><br><span class="line"><span class="comment">//     list : ['apple','orange','banana']</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"><span class="comment">// console.log(ret);</span></span><br><span class="line"><span class="comment">// -----------------------------------</span></span><br><span class="line"><span class="comment">// let tpl = '&lt;ul&gt;&#123;&#123;each list as value&#125;&#125;&lt;li&gt;&#123;&#123;value&#125;&#125;&lt;/li&gt;&#123;&#123;/each&#125;&#125;&lt;/ul&gt;';</span></span><br><span class="line"><span class="comment">// let tpl = '&lt;ul&gt;&#123;&#123;each list&#125;&#125;&lt;li&gt;&#123;&#123;$index&#125;&#125;-------------&#123;&#123;$value&#125;&#125;&lt;/li&gt;&#123;&#123;/each&#125;&#125;&lt;/ul&gt;';</span></span><br><span class="line"><span class="comment">// let ret = template.render(tpl,&#123;</span></span><br><span class="line"><span class="comment">//     list : ['apple','orange','banana','pineapple']</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"><span class="comment">// console.log(ret);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> html = template(__dirname + <span class="string">'/score.art'</span>, &#123;</span><br><span class="line">    chinese : <span class="string">'120'</span>,</span><br><span class="line">    math : <span class="string">'130'</span>,</span><br><span class="line">    english : <span class="string">'146'</span>,</span><br><span class="line">    summary : <span class="string">'268'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(html);</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- mytpl.art --&gt;</span></span><br><span class="line">&#123;&#123;if user&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;user.name&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">&#123;&#123;/if&#125;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- score.art --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>成绩结果<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>语文：&#123;&#123;chinese&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>数学：&#123;&#123;math&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>外语：&#123;&#123;english&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>综合：&#123;&#123;summary&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    优化</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"><span class="keyword">const</span> scoreData = <span class="built_in">require</span>(<span class="string">'./scores.json'</span>);</span><br><span class="line"><span class="keyword">const</span> template = <span class="built_in">require</span>(<span class="string">'art-template'</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 路由（请求路径+请求方式）</span></span><br><span class="line">    <span class="comment">// 查询成绩的入口地址 /query</span></span><br><span class="line">    <span class="keyword">if</span>(req.url.startsWith(<span class="string">'/query'</span>) &amp;&amp; req.method == <span class="string">'GET'</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> content = template(path.join(__dirname,<span class="string">'view'</span>,<span class="string">'index.art'</span>),&#123;&#125;);</span><br><span class="line">        res.end(content);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(req.url.startsWith(<span class="string">'/score'</span>) &amp;&amp; req.method == <span class="string">'POST'</span>)&#123;</span><br><span class="line">        <span class="comment">// 获取成绩的结果 /score</span></span><br><span class="line">        <span class="keyword">let</span> pdata = <span class="string">''</span>;</span><br><span class="line">        req.on(<span class="string">'data'</span>,(chunk)=&gt;&#123;</span><br><span class="line">            pdata += chunk;</span><br><span class="line">        &#125;);</span><br><span class="line">        req.on(<span class="string">'end'</span>,()=&gt;&#123;</span><br><span class="line">            <span class="keyword">let</span> obj = querystring.parse(pdata);</span><br><span class="line">            <span class="keyword">let</span> result = scoreData[obj.code];</span><br><span class="line">            <span class="keyword">let</span> content = template(path.join(__dirname,<span class="string">'view'</span>,<span class="string">'result.art'</span>),result);</span><br><span class="line">            res.end(content);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(req.url.startsWith(<span class="string">'/all'</span>) &amp;&amp; req.method == <span class="string">'GET'</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> arr = [];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> scoreData)&#123;</span><br><span class="line">            arr.push(scoreData[key]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 全部成绩</span></span><br><span class="line">        <span class="keyword">let</span> content = template(path.join(__dirname,<span class="string">'view'</span>,<span class="string">'list.art'</span>),&#123;</span><br><span class="line">            list : arr</span><br><span class="line">        &#125;);</span><br><span class="line">        res.end(content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running....'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.art --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>查询成绩<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://localhost:3000/score"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">        请输入考号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"code"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"查询"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://localhost:3000/all"</span>&gt;</span>全部成绩<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- result.art --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>成绩结果<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>语文：&#123;&#123;chinese&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>数学：&#123;&#123;math&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>外语：&#123;&#123;english&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>综合：&#123;&#123;summary&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- list.art --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>所有信息<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        &#123;&#123;each list&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>语文：&#123;&#123;$value.chinese&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>数学：&#123;&#123;$value.math&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>外语：&#123;&#123;$value.english&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>综合：&#123;&#123;$value.summary&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        &#123;&#123;/each&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"no123"</span> : &#123;</span><br><span class="line">        <span class="attr">"chinese"</span> : <span class="string">"100"</span>,</span><br><span class="line">        <span class="attr">"math"</span> : <span class="string">"140"</span>,</span><br><span class="line">        <span class="attr">"english"</span> : <span class="string">"149"</span>,</span><br><span class="line">        <span class="attr">"summary"</span> : <span class="string">"289"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"no124"</span> : &#123;</span><br><span class="line">        <span class="attr">"chinese"</span> : <span class="string">"120"</span>,</span><br><span class="line">        <span class="attr">"math"</span> : <span class="string">"120"</span>,</span><br><span class="line">        <span class="attr">"english"</span> : <span class="string">"119"</span>,</span><br><span class="line">        <span class="attr">"summary"</span> : <span class="string">"239"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"no125"</span> : &#123;</span><br><span class="line">        <span class="attr">"chinese"</span> : <span class="string">"130"</span>,</span><br><span class="line">        <span class="attr">"math"</span> : <span class="string">"110"</span>,</span><br><span class="line">        <span class="attr">"english"</span> : <span class="string">"139"</span>,</span><br><span class="line">        <span class="attr">"summary"</span> : <span class="string">"269"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>##小结<br>Node.js的Web开发相关的内容：<br>1、Node.js不需要依赖第三方应用软件（Apache），可以基于api自己实现<br>2、实现静态资源服务器<br>3、路由处理<br>4、动态网站<br>5、模板引擎<br>6、get和post参数传递和处理</p>
<h2 id="Express基本使用"><a href="#Express基本使用" class="headerlink" title="Express基本使用"></a>Express基本使用</h2><ul>
<li>静态服务器</li>
<li>路由</li>
<li>中间件</li>
<li>模板引擎整合</li>
<li>常用API基本使用</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    初步实现服务器功能</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="comment">// const app = require('express')();</span></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    res.send(<span class="string">'ok'</span>);</span><br><span class="line">&#125;).listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------</span></span><br><span class="line"><span class="keyword">let</span> server = app.get(<span class="string">'/'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    res.send(<span class="string">'abc'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    托管静态文件</span></span><br><span class="line"><span class="comment">    可以指定虚拟目录</span></span><br><span class="line"><span class="comment">    可以指定多个目录作为静态资源目录</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="comment">// 实现静态资源服务</span></span><br><span class="line"><span class="comment">// use方法的第一个参数可以指定一个虚拟路径</span></span><br><span class="line"><span class="comment">// let server = app.use('/abc',express.static('public'));</span></span><br><span class="line"><span class="comment">// app.use('/nihao',express.static('hello'));</span></span><br><span class="line"><span class="comment">// server.listen(3000,()=&gt;&#123;</span></span><br><span class="line"><span class="comment">//     console.log('running...');</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// -----------------------------------</span></span><br><span class="line">app.use(<span class="string">'/abc'</span>,express.static(<span class="string">'public'</span>));</span><br><span class="line"><span class="comment">// app.use('/nihao',express.static('hello'));</span></span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//public、hello是文件夹，里面存放着文件资源</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    路由（根据请求路径和请求方式进行路径分发处理）</span></span><br><span class="line"><span class="comment">    http的常用请求方式：</span></span><br><span class="line"><span class="comment">    post   添加</span></span><br><span class="line"><span class="comment">    get    查询</span></span><br><span class="line"><span class="comment">    put    更新</span></span><br><span class="line"><span class="comment">    delete 删除</span></span><br><span class="line"><span class="comment">    restful api (一种URL的格式)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基本的路由处理</span></span><br><span class="line">app.get(<span class="string">'/'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    res.send(<span class="string">'get data'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// app.post('/',(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//     res.send('post data');</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"><span class="comment">// app.put('/',(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//     res.send('put data');</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"><span class="comment">// app.delete('/',(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//     res.send('delete data');</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接使用use分发可以处理所有的路由请求</span></span><br><span class="line"><span class="comment">// app.use((req,res)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//     res.send('ok');</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// all方法绑定的路由与请求方式无关</span></span><br><span class="line">app.all(<span class="string">'/abc'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    res.end(<span class="string">'test router'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// route方法可以指定特定的请求方式</span></span><br><span class="line">app.route(<span class="string">'/hello'</span>)</span><br><span class="line">   .get(<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">       res.send(<span class="string">'get data'</span>);</span><br><span class="line">   &#125;).post(<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">       res.send(<span class="string">'post data'</span>);</span><br><span class="line">   &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 封装路由模块</span></span><br><span class="line"><span class="comment">// const express = require('express');</span></span><br><span class="line"><span class="comment">// const router = express.Router();</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// router.get('/hi',(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//     res.send('hi router');</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// router.get('/hello',(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//     res.send('hello router');</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// router.post('/abc',(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//     res.send('abc router');</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// module.exports = router;</span></span><br><span class="line"><span class="comment">// 调用封装的路由模块</span></span><br><span class="line"><span class="comment">// const router = require('./myrouter.js');</span></span><br><span class="line"><span class="comment">// app.use('/admin',router);</span></span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Express基本使用-1"><a href="#Express基本使用-1" class="headerlink" title="Express基本使用"></a>Express基本使用</h2><ul>
<li>中间件:应用级中间件 路由级中间件 错误处理中间件 内置中间件 第三方中间件</li>
<li>参数处理</li>
<li>模板引擎整合</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    中间件：就是处理过程中的一个环节（本质上就是一个函数）</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">let</span> total = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">app.use(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'有人访问'</span>);</span><br><span class="line">    <span class="comment">// next方法的作用就是把请求传递到下一个中间件</span></span><br><span class="line">    next()</span><br><span class="line">&#125;);</span><br><span class="line">app.use(<span class="string">'/user'</span>,(req,res,next)=&gt;&#123;</span><br><span class="line">    <span class="comment">// 记录访问时间</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">Date</span>.now());</span><br><span class="line">    <span class="comment">// next方法的作用就是把请求传递到下一个中间件</span></span><br><span class="line">    next()</span><br><span class="line">&#125;);</span><br><span class="line">app.use(<span class="string">'/user'</span>,(req,res,next)=&gt;&#123;</span><br><span class="line">    <span class="comment">// 记录访问日志</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'访问了/user'</span>);</span><br><span class="line">    next()</span><br><span class="line">&#125;);</span><br><span class="line">app.use(<span class="string">'/user'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    total++;</span><br><span class="line">    <span class="built_in">console</span>.log(total);</span><br><span class="line">    res.send(<span class="string">'result'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    中间件的挂载方式和执行流程</span></span><br><span class="line"><span class="comment">    use方法</span></span><br><span class="line"><span class="comment">    路由方式:get post put delete</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/abc'</span>,(req,res,next)=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 跳转到下一个路由</span></span><br><span class="line">    next(<span class="string">'route'</span>);</span><br><span class="line">&#125;,(req,res)=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">    res.send(<span class="string">'abc'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/abc'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">    res.send(<span class="string">'hello'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------------------------</span></span><br><span class="line"><span class="comment">// var cb0 = function (req, res, next) &#123;</span></span><br><span class="line"><span class="comment">//   console.log('CB0');</span></span><br><span class="line"><span class="comment">//   next();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// var cb1 = function (req, res, next) &#123;</span></span><br><span class="line"><span class="comment">//   console.log('CB1');</span></span><br><span class="line"><span class="comment">//   next();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// var cb2 = function (req, res) &#123;</span></span><br><span class="line"><span class="comment">//   res.send('Hello from C!');</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// app.get('/example', [cb0, cb1, cb2]);</span></span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    应用中间件</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>)</span><br><span class="line"><span class="comment">// 挂载内置中间件</span></span><br><span class="line">app.use(express.static(<span class="string">'public'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 挂载参数处理中间件（post）</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理get提交参数</span></span><br><span class="line">app.get(<span class="string">'/login'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> data = req.query;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    res.send(<span class="string">'get data'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理post提交参数</span></span><br><span class="line">app.post(<span class="string">'/login'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> data = req.body;</span><br><span class="line">    <span class="comment">// console.log(data);</span></span><br><span class="line">    <span class="keyword">if</span>(data.username == <span class="string">'admin'</span> &amp;&amp; data.password == <span class="string">'123'</span>)&#123;</span><br><span class="line">        res.send(<span class="string">'success'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        res.send(<span class="string">'failure'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    参数处理</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>)</span><br><span class="line"><span class="comment">// 挂载内置中间件</span></span><br><span class="line">app.use(express.static(<span class="string">'public'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 挂载参数处理中间件（post）</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line"><span class="comment">// 处理json格式的参数</span></span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理get提交参数</span></span><br><span class="line">app.get(<span class="string">'/login'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> data = req.query;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    res.send(<span class="string">'get data'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理post提交参数</span></span><br><span class="line">app.post(<span class="string">'/login'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> data = req.body;</span><br><span class="line">    <span class="comment">// console.log(data);</span></span><br><span class="line">    <span class="keyword">if</span>(data.username == <span class="string">'admin'</span> &amp;&amp; data.password == <span class="string">'123'</span>)&#123;</span><br><span class="line">        res.send(<span class="string">'success'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        res.send(<span class="string">'failure'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.put(<span class="string">'/login'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    res.end(<span class="string">'put data'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.delete(<span class="string">'/login'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    res.end(<span class="string">'delete data'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    模板引擎整合：art-template</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> template = <span class="built_in">require</span>(<span class="string">'art-template'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置模板的路径</span></span><br><span class="line">app.set(<span class="string">'views'</span>,path.join(__dirname,<span class="string">'views'</span>));</span><br><span class="line"><span class="comment">// 设置模板引擎</span></span><br><span class="line">app.set(<span class="string">'view engine'</span>,<span class="string">'art'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使express兼容art-template模板引擎</span></span><br><span class="line">app.engine(<span class="string">'art'</span>, <span class="built_in">require</span>(<span class="string">'express-art-template'</span>));</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/list'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> data = &#123;</span><br><span class="line">        title : <span class="string">'水果'</span>,</span><br><span class="line">        list : [<span class="string">'apple'</span>,<span class="string">'orange'</span>,<span class="string">'banana'</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 参数一：模板名称；参数二：渲染模板的数据</span></span><br><span class="line">    res.render(<span class="string">'list'</span>,data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Express图书管理案例"><a href="#Express图书管理案例" class="headerlink" title="Express图书管理案例"></a>Express图书管理案例</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">'./router.js'</span>);</span><br><span class="line"><span class="keyword">const</span> template = <span class="built_in">require</span>(<span class="string">'art-template'</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动静态资源服务</span></span><br><span class="line">app.use(<span class="string">'/www'</span>,express.static(<span class="string">'public'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置模板引擎</span></span><br><span class="line"><span class="comment">// 设置模板的路径</span></span><br><span class="line">app.set(<span class="string">'views'</span>,path.join(__dirname,<span class="string">'views'</span>));</span><br><span class="line"><span class="comment">// 设置模板引擎</span></span><br><span class="line">app.set(<span class="string">'view engine'</span>,<span class="string">'art'</span>);</span><br><span class="line"><span class="comment">// 使express兼容art-template模板引擎</span></span><br><span class="line">app.engine(<span class="string">'art'</span>, <span class="built_in">require</span>(<span class="string">'express-art-template'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理请求参数</span></span><br><span class="line"><span class="comment">// 挂载参数处理中间件（post）</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line"><span class="comment">// 处理json格式的参数</span></span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动服务器功能</span></span><br><span class="line"><span class="comment">// 配置路由</span></span><br><span class="line">app.use(router);</span><br><span class="line"><span class="comment">// 监听端口</span></span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    路由模块 router.js</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="keyword">const</span> service = <span class="built_in">require</span>(<span class="string">'./service.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由处理</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 渲染主页</span></span><br><span class="line">router.get(<span class="string">'/'</span>,service.showIndex);</span><br><span class="line"><span class="comment">// 添加图书(跳转到添加图书的页面)</span></span><br><span class="line">router.get(<span class="string">'/toAddBook'</span>,service.toAddBook);</span><br><span class="line"><span class="comment">// 添加图书(提交表单)</span></span><br><span class="line">router.post(<span class="string">'/addBook'</span>,service.addBook);</span><br><span class="line"><span class="comment">// 跳转到编辑图书信息页面</span></span><br><span class="line">router.get(<span class="string">'/toEditBook'</span>,service.toEditBook);</span><br><span class="line"><span class="comment">// 编辑图书提交表单</span></span><br><span class="line">router.post(<span class="string">'/editBook'</span>,service.editBook);</span><br><span class="line"><span class="comment">// 删除图书信息</span></span><br><span class="line">router.get(<span class="string">'/deleteBook'</span>,service.deleteBook);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    业务模块 service.js</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> data = <span class="built_in">require</span>(<span class="string">'./data.json'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="comment">// 自动生成图书编号（自增）</span></span><br><span class="line"><span class="keyword">let</span> maxBookCode = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [];</span><br><span class="line">    data.forEach(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">        arr.push(item.id);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.max.apply(<span class="literal">null</span>,arr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 把内存数据写入文件</span></span><br><span class="line"><span class="keyword">let</span> writeDataToFile = <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.writeFile(path.join(__dirname,<span class="string">'data.json'</span>),<span class="built_in">JSON</span>.stringify(data,<span class="literal">null</span>,<span class="number">4</span>),(err)=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            res.send(<span class="string">'server error'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 文件写入成功之后重新跳转到主页面</span></span><br><span class="line">        res.redirect(<span class="string">'/'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 渲染主页面</span></span><br><span class="line">exports.showIndex = <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.render(<span class="string">'index'</span>,&#123;<span class="attr">list</span> : data&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 跳转到添加图书的页面</span></span><br><span class="line">exports.toAddBook = <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.render(<span class="string">'addBook'</span>,&#123;&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 添加图书保存数据</span></span><br><span class="line">exports.addBook = <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 获取表单数据</span></span><br><span class="line">    <span class="keyword">let</span> info = req.body;</span><br><span class="line">    <span class="keyword">let</span> book = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> info)&#123;</span><br><span class="line">        book[key] = info[key];</span><br><span class="line">    &#125;</span><br><span class="line">    book.id = maxBookCode() + <span class="number">1</span>;</span><br><span class="line">    data.push(book);</span><br><span class="line">    <span class="comment">// 把内存中的数据写入文件</span></span><br><span class="line">    writeDataToFile(res);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 跳转编辑图书页面</span></span><br><span class="line">exports.toEditBook = <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> id = req.query.id;</span><br><span class="line">    <span class="keyword">let</span> book = &#123;&#125;;</span><br><span class="line">    data.forEach(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(id == item.id)&#123;</span><br><span class="line">            book = item;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    res.render(<span class="string">'editBook'</span>,book);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 编辑图书更新数据</span></span><br><span class="line">exports.editBook = <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> info = req.body;</span><br><span class="line">    data.forEach(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(info.id == item.id)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> info)&#123;</span><br><span class="line">                item[key] = info[key];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 把内存中的数据写入文件</span></span><br><span class="line">    writeDataToFile(res);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删除图书信息</span></span><br><span class="line">exports.deleteBook = <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> id = req.query.id;</span><br><span class="line">    data.forEach(<span class="function">(<span class="params">item,index</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(id == item.id)&#123;</span><br><span class="line">            <span class="comment">// 删除数组的一项数据</span></span><br><span class="line">            data.splice(index,<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 把内存中的数据写入文件</span></span><br><span class="line">    writeDataToFile(res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.art --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>图书管理系统<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"/www/style.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>图书管理系统<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/toAddBook"</span>&gt;</span>添加图书<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">cellpadding</span>=<span class="string">"0"</span> <span class="attr">cellspacing</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>编号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>作者<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>分类<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>描述<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                &#123;&#123;each list&#125;&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.id&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.author&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.category&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.desc&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/toEditBook?id=&#123;&#123;$value.id&#125;&#125;"</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">a</span>&gt;</span>|<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/deleteBook?id=&#123;&#123;$value.id&#125;&#125;"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                &#123;&#123;/each&#125;&#125;</span><br><span class="line">                <span class="comment">&lt;!-- &lt;tr&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;1&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;西游记&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;吴承恩&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;文学&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;佛教与道教的斗争&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;&lt;a href="#"&gt;修改&lt;/a&gt;|&lt;a href="#"&gt;删除&lt;/a&gt;&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                &lt;/tr&gt;</span></span><br><span class="line"><span class="comment">                &lt;tr&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;1&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;西游记&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;吴承恩&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;文学&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;佛教与道教的斗争&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;&lt;a href="#"&gt;修改&lt;/a&gt;|&lt;a href="#"&gt;删除&lt;/a&gt;&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                &lt;/tr&gt;</span></span><br><span class="line"><span class="comment">                &lt;tr&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;1&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;西游记&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;吴承恩&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;文学&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;佛教与道教的斗争&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;&lt;a href="#"&gt;修改&lt;/a&gt;|&lt;a href="#"&gt;删除&lt;/a&gt;&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                &lt;/tr&gt; --&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- addBook.art --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>添加图书<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>添加图书<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/addBook"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">        名称：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        作者：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"author"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        分类：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"category"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        描述：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"desc"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- editBook.art --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>修改图书<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>修改图书<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/editBook"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123;id&#125;&#125;"</span>&gt;</span></span><br><span class="line">        名称：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123;name&#125;&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        作者：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123;author&#125;&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        分类：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"category"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123;category&#125;&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        描述：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"desc"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123;desc&#125;&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="string">"1"</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"三国演义"</span>,</span><br><span class="line">        <span class="attr">"author"</span>: <span class="string">"罗贯中"</span>,</span><br><span class="line">        <span class="attr">"category"</span>: <span class="string">"文学"</span>,</span><br><span class="line">        <span class="attr">"desc"</span>: <span class="string">"一个杀伐纷争的年代"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="string">"2"</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"水浒传"</span>,</span><br><span class="line">        <span class="attr">"author"</span>: <span class="string">"施耐庵"</span>,</span><br><span class="line">        <span class="attr">"category"</span>: <span class="string">"文学"</span>,</span><br><span class="line">        <span class="attr">"desc"</span>: <span class="string">"108条好汉的故事"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="string">"3"</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"西游记"</span>,</span><br><span class="line">        <span class="attr">"author"</span>: <span class="string">"吴承恩"</span>,</span><br><span class="line">        <span class="attr">"category"</span>: <span class="string">"文学"</span>,</span><br><span class="line">        <span class="attr">"desc"</span>: <span class="string">"佛教与道教的斗争"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="string">"4"</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"红楼梦"</span>,</span><br><span class="line">        <span class="attr">"author"</span>: <span class="string">"曹雪芹"</span>,</span><br><span class="line">        <span class="attr">"category"</span>: <span class="string">"文学"</span>,</span><br><span class="line">        <span class="attr">"desc"</span>: <span class="string">"一个封建王朝的缩影"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"天龙八部"</span>,</span><br><span class="line">        <span class="attr">"author"</span>: <span class="string">"金庸"</span>,</span><br><span class="line">        <span class="attr">"category"</span>: <span class="string">"文学"</span>,</span><br><span class="line">        <span class="attr">"desc"</span>: <span class="string">"武侠小说"</span>,</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="Node-js操作数据库"><a href="#Node-js操作数据库" class="headerlink" title="Node.js操作数据库"></a>Node.js操作数据库</h2><ul>
<li>Mysql环境准备<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    把data.json文件中的数据拼接成insert语句</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line">fs.readFile(path.join(__dirname,<span class="string">'../'</span>,<span class="string">'data.json'</span>),<span class="string">'utf8'</span>,(err,content)=&gt;&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">let</span> list = <span class="built_in">JSON</span>.parse(content);</span><br><span class="line">    <span class="keyword">let</span> arr = [];</span><br><span class="line">    list.forEach(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> sql = <span class="string">`insert into book (name,author,category,description) values ('<span class="subst">$&#123;item.name&#125;</span>','<span class="subst">$&#123;item.author&#125;</span>','<span class="subst">$&#123;item.category&#125;</span>','<span class="subst">$&#123;item.desc&#125;</span>');`</span>;</span><br><span class="line">        arr.push(sql);</span><br><span class="line">    &#125;);</span><br><span class="line">    fs.writeFile(path.join(__dirname,<span class="string">'data.sql'</span>),arr.join(<span class="string">''</span>),<span class="string">'utf8'</span>,(err)=&gt;&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'init data finished!'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    操作数据库基本步骤</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 加载数据库驱动</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"><span class="comment">// 创建数据库连接</span></span><br><span class="line"><span class="keyword">const</span> connection = mysql.createConnection(&#123;</span><br><span class="line">    host: <span class="string">'localhost'</span>, <span class="comment">// 数据库所在的服务器的域名或者IP地址</span></span><br><span class="line">    user: <span class="string">'root'</span>, <span class="comment">// 登录数据库的账号</span></span><br><span class="line">    password: <span class="string">''</span>, <span class="comment">// 登录数据库的密码</span></span><br><span class="line">    database: <span class="string">'book'</span> <span class="comment">// 数据库名称</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 执行连接操作</span></span><br><span class="line">connection.connect();</span><br><span class="line"><span class="comment">// 操作数据库</span></span><br><span class="line">connection.query(<span class="string">'select count(*) as total from book'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">error, results, fields</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'表book中共有'</span>, results[<span class="number">0</span>].total + <span class="string">'条数据'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 关闭数据库</span></span><br><span class="line">connection.end();</span><br></pre></td></tr></table></figure>
<h2 id="mysql第三方包基本使用"><a href="#mysql第三方包基本使用" class="headerlink" title="mysql第三方包基本使用"></a>mysql第三方包基本使用</h2><ul>
<li>操作数据库基本步骤</li>
<li>实现增删改成基本操作<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    插入数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 加载数据库驱动</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"><span class="comment">// 创建数据库连接</span></span><br><span class="line"><span class="keyword">const</span> connection = mysql.createConnection(&#123;</span><br><span class="line">    host: <span class="string">'localhost'</span>, <span class="comment">// 数据库所在的服务器的域名或者IP地址</span></span><br><span class="line">    user: <span class="string">'root'</span>, <span class="comment">// 登录数据库的账号</span></span><br><span class="line">    password: <span class="string">''</span>, <span class="comment">// 登录数据库的密码</span></span><br><span class="line">    database: <span class="string">'book'</span> <span class="comment">// 数据库名称</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 执行连接操作</span></span><br><span class="line">connection.connect();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sql = <span class="string">'insert into book set ?'</span></span><br><span class="line"><span class="keyword">let</span> data = &#123;</span><br><span class="line">    name : <span class="string">'明朝那些事'</span>,</span><br><span class="line">    author : <span class="string">'当年明月'</span>,</span><br><span class="line">    category : <span class="string">'文学'</span>,</span><br><span class="line">    description : <span class="string">'明朝的历史'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 操作数据库</span></span><br><span class="line">connection.query(sql,data, <span class="function"><span class="keyword">function</span>(<span class="params">error, results, fields</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">    <span class="comment">// console.log(results);</span></span><br><span class="line">    <span class="keyword">if</span>(results.affectedRows == <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'数据插入成功'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 关闭数据库</span></span><br><span class="line">connection.end();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    更新数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 加载数据库驱动</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"><span class="comment">// 创建数据库连接</span></span><br><span class="line"><span class="keyword">const</span> connection = mysql.createConnection(&#123;</span><br><span class="line">    host: <span class="string">'localhost'</span>, <span class="comment">// 数据库所在的服务器的域名或者IP地址</span></span><br><span class="line">    user: <span class="string">'root'</span>, <span class="comment">// 登录数据库的账号</span></span><br><span class="line">    password: <span class="string">''</span>, <span class="comment">// 登录数据库的密码</span></span><br><span class="line">    database: <span class="string">'book'</span> <span class="comment">// 数据库名称</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 执行连接操作</span></span><br><span class="line">connection.connect();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sql = <span class="string">'update book set name=?,author=?,category=?,description=? where id=?'</span>;</span><br><span class="line"><span class="keyword">let</span> data = [<span class="string">'浪潮之巅'</span>,<span class="string">'吴军'</span>,<span class="string">'计算机'</span>,<span class="string">'IT巨头的兴衰史'</span>,<span class="number">8</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 操作数据库</span></span><br><span class="line">connection.query(sql,data, <span class="function"><span class="keyword">function</span>(<span class="params">error, results, fields</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">    <span class="comment">// console.log(results);</span></span><br><span class="line">    <span class="keyword">if</span>(results.affectedRows == <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'更新成功'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 关闭数据库</span></span><br><span class="line">connection.end();</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    删除数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 加载数据库驱动</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"><span class="comment">// 创建数据库连接</span></span><br><span class="line"><span class="keyword">const</span> connection = mysql.createConnection(&#123;</span><br><span class="line">    host: <span class="string">'localhost'</span>, <span class="comment">// 数据库所在的服务器的域名或者IP地址</span></span><br><span class="line">    user: <span class="string">'root'</span>, <span class="comment">// 登录数据库的账号</span></span><br><span class="line">    password: <span class="string">''</span>, <span class="comment">// 登录数据库的密码</span></span><br><span class="line">    database: <span class="string">'book'</span> <span class="comment">// 数据库名称</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 执行连接操作</span></span><br><span class="line">connection.connect();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sql = <span class="string">'delete from book where id = ?'</span>;</span><br><span class="line"><span class="keyword">let</span> data = [<span class="number">9</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 操作数据库</span></span><br><span class="line">connection.query(sql,data, <span class="function"><span class="keyword">function</span>(<span class="params">error, results, fields</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">    <span class="comment">// console.log(results);</span></span><br><span class="line">    <span class="keyword">if</span>(results.affectedRows == <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'删除成功'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 关闭数据库</span></span><br><span class="line">connection.end();</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    查询数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 加载数据库驱动</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"><span class="comment">// 创建数据库连接</span></span><br><span class="line"><span class="keyword">const</span> connection = mysql.createConnection(&#123;</span><br><span class="line">    host: <span class="string">'localhost'</span>, <span class="comment">// 数据库所在的服务器的域名或者IP地址</span></span><br><span class="line">    user: <span class="string">'root'</span>, <span class="comment">// 登录数据库的账号</span></span><br><span class="line">    password: <span class="string">''</span>, <span class="comment">// 登录数据库的密码</span></span><br><span class="line">    database: <span class="string">'book'</span> <span class="comment">// 数据库名称</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 执行连接操作</span></span><br><span class="line">connection.connect();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sql = <span class="string">'select * from book where id = ?'</span>;</span><br><span class="line"><span class="keyword">let</span> data = [<span class="number">6</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 操作数据库</span></span><br><span class="line">connection.query(sql,data, <span class="function"><span class="keyword">function</span>(<span class="params">error, results, fields</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">    <span class="built_in">console</span>.log(results[<span class="number">0</span>].name);</span><br><span class="line">    <span class="comment">// console.log(results);</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 关闭数据库</span></span><br><span class="line">connection.end();</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    封装操作数据库的通用api</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"></span><br><span class="line">exports.base = <span class="function">(<span class="params">sql,data,callback</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 创建数据库连接</span></span><br><span class="line">    <span class="keyword">const</span> connection = mysql.createConnection(&#123;</span><br><span class="line">        host: <span class="string">'localhost'</span>, <span class="comment">// 数据库所在的服务器的域名或者IP地址</span></span><br><span class="line">        user: <span class="string">'root'</span>, <span class="comment">// 登录数据库的账号</span></span><br><span class="line">        password: <span class="string">''</span>, <span class="comment">// 登录数据库的密码</span></span><br><span class="line">        database: <span class="string">'book'</span> <span class="comment">// 数据库名称</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 执行连接操作</span></span><br><span class="line">    connection.connect();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 操作数据库(数据库操作也是异步的)</span></span><br><span class="line">    connection.query(sql,data, <span class="function"><span class="keyword">function</span>(<span class="params">error, results, fields</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">        callback(results);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 关闭数据库</span></span><br><span class="line">    connection.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    测试通用api</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">'./db.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 插入操作</span></span><br><span class="line"><span class="keyword">let</span> sql = <span class="string">'insert into book set ?'</span>;</span><br><span class="line"><span class="keyword">let</span> data = &#123;</span><br><span class="line">    name : <span class="string">'笑傲江湖'</span>,</span><br><span class="line">    author : <span class="string">'金庸'</span>,</span><br><span class="line">    category : <span class="string">'文学'</span>,</span><br><span class="line">    description : <span class="string">'武侠小说'</span></span><br><span class="line">&#125;</span><br><span class="line">db.base(sql,data,(result)=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 更新操作</span></span><br><span class="line"><span class="keyword">let</span> sql = <span class="string">'update book set name=?,author=?,category=?,description=? where ?'</span>;</span><br><span class="line"><span class="keyword">let</span> data = [<span class="string">'天龙八部'</span>,<span class="string">'金庸'</span>,<span class="string">'文学'</span>,<span class="string">'武侠小说'</span>,<span class="number">11</span>];</span><br><span class="line">db.base(sql,data,(result)=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br><span class="line">删除操作</span><br><span class="line"><span class="keyword">let</span> sql = <span class="string">'delete from book where id = ?'</span>;</span><br><span class="line"><span class="keyword">let</span> data = [<span class="number">11</span>];</span><br><span class="line">db.base(sql,data,(result)=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 查询操作</span></span><br><span class="line"><span class="keyword">let</span> sql = <span class="string">'select * from book where id = ?'</span>;</span><br><span class="line"><span class="keyword">let</span> data = [<span class="number">8</span>];</span><br><span class="line">db.base(sql,data,(result)=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result[<span class="number">0</span>].name);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="基于数据库实现登录功能"><a href="#基于数据库实现登录功能" class="headerlink" title="基于数据库实现登录功能"></a>基于数据库实现登录功能</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    登录验证（前端+后端+数据库）</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">'./db.js'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(express.static(<span class="string">'public'</span>));</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">'/check'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> param = req.body;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> sql = <span class="string">'select count(*) as total from user where username=? and password=?'</span>;</span><br><span class="line">    <span class="keyword">let</span> data = [param.username,param.password];</span><br><span class="line"></span><br><span class="line">    db.base(sql,data,(result)=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(result[<span class="number">0</span>].total == <span class="number">1</span>)&#123;</span><br><span class="line">            res.send(<span class="string">'login success!'</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.send(<span class="string">'login failure!'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    封装操作数据库的通用api</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"></span><br><span class="line">exports.base = <span class="function">(<span class="params">sql,data,callback</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 创建数据库连接</span></span><br><span class="line">    <span class="keyword">const</span> connection = mysql.createConnection(&#123;</span><br><span class="line">        host: <span class="string">'localhost'</span>, <span class="comment">// 数据库所在的服务器的域名或者IP地址</span></span><br><span class="line">        user: <span class="string">'root'</span>, <span class="comment">// 登录数据库的账号</span></span><br><span class="line">        password: <span class="string">''</span>, <span class="comment">// 登录数据库的密码</span></span><br><span class="line">        database: <span class="string">'book'</span> <span class="comment">// 数据库名称</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 执行连接操作</span></span><br><span class="line">    connection.connect();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 操作数据库(数据库操作也是异步的)</span></span><br><span class="line">    connection.query(sql,data, <span class="function"><span class="keyword">function</span>(<span class="params">error, results, fields</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">        callback(results);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 关闭数据库</span></span><br><span class="line">    connection.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://localhost:3000/check"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">        用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"登录"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="图书管理系统整合数据库"><a href="#图书管理系统整合数据库" class="headerlink" title="图书管理系统整合数据库"></a>图书管理系统整合数据库</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">'./router.js'</span>);</span><br><span class="line"><span class="keyword">const</span> template = <span class="built_in">require</span>(<span class="string">'art-template'</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动静态资源服务</span></span><br><span class="line">app.use(<span class="string">'/www'</span>,express.static(<span class="string">'public'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置模板引擎</span></span><br><span class="line"><span class="comment">// 设置模板的路径</span></span><br><span class="line">app.set(<span class="string">'views'</span>,path.join(__dirname,<span class="string">'views'</span>));</span><br><span class="line"><span class="comment">// 设置模板引擎</span></span><br><span class="line">app.set(<span class="string">'view engine'</span>,<span class="string">'art'</span>);</span><br><span class="line"><span class="comment">// 使express兼容art-template模板引擎</span></span><br><span class="line">app.engine(<span class="string">'art'</span>, <span class="built_in">require</span>(<span class="string">'express-art-template'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理请求参数</span></span><br><span class="line"><span class="comment">// 挂载参数处理中间件（post）</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line"><span class="comment">// 处理json格式的参数</span></span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动服务器功能</span></span><br><span class="line"><span class="comment">// 配置路由</span></span><br><span class="line">app.use(router);</span><br><span class="line"><span class="comment">// 监听端口</span></span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    路由模块 router.js</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="keyword">const</span> service = <span class="built_in">require</span>(<span class="string">'./service.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由处理</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 渲染主页</span></span><br><span class="line">router.get(<span class="string">'/'</span>,service.showIndex);</span><br><span class="line"><span class="comment">// 添加图书(跳转到添加图书的页面)</span></span><br><span class="line">router.get(<span class="string">'/toAddBook'</span>,service.toAddBook);</span><br><span class="line"><span class="comment">// 添加图书(提交表单)</span></span><br><span class="line">router.post(<span class="string">'/addBook'</span>,service.addBook);</span><br><span class="line"><span class="comment">// 跳转到编辑图书信息页面</span></span><br><span class="line">router.get(<span class="string">'/toEditBook'</span>,service.toEditBook);</span><br><span class="line"><span class="comment">// 编辑图书提交表单</span></span><br><span class="line">router.post(<span class="string">'/editBook'</span>,service.editBook);</span><br><span class="line"><span class="comment">// 删除图书信息</span></span><br><span class="line">router.get(<span class="string">'/deleteBook'</span>,service.deleteBook);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    封装操作数据库的通用api db.js</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"></span><br><span class="line">exports.base = <span class="function">(<span class="params">sql,data,callback</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 创建数据库连接</span></span><br><span class="line">    <span class="keyword">const</span> connection = mysql.createConnection(&#123;</span><br><span class="line">        host: <span class="string">'localhost'</span>, <span class="comment">// 数据库所在的服务器的域名或者IP地址</span></span><br><span class="line">        user: <span class="string">'root'</span>, <span class="comment">// 登录数据库的账号</span></span><br><span class="line">        password: <span class="string">''</span>, <span class="comment">// 登录数据库的密码</span></span><br><span class="line">        database: <span class="string">'book'</span> <span class="comment">// 数据库名称</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 执行连接操作</span></span><br><span class="line">    connection.connect();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 操作数据库(数据库操作也是异步的)</span></span><br><span class="line">    connection.query(sql,data, <span class="function"><span class="keyword">function</span>(<span class="params">error, results, fields</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">        callback(results);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 关闭数据库</span></span><br><span class="line">    connection.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    业务模块 service.js</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> data = <span class="built_in">require</span>(<span class="string">'./data.json'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">'./db.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动生成图书编号（自增）</span></span><br><span class="line"><span class="keyword">let</span> maxBookCode = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [];</span><br><span class="line">    data.forEach(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">        arr.push(item.id);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.max.apply(<span class="literal">null</span>,arr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 把内存数据写入文件</span></span><br><span class="line"><span class="keyword">let</span> writeDataToFile = <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.writeFile(path.join(__dirname,<span class="string">'data.json'</span>),<span class="built_in">JSON</span>.stringify(data,<span class="literal">null</span>,<span class="number">4</span>),(err)=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            res.send(<span class="string">'server error'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 文件写入成功之后重新跳转到主页面</span></span><br><span class="line">        res.redirect(<span class="string">'/'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 渲染主页面</span></span><br><span class="line">exports.showIndex = <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> sql = <span class="string">'select * from book'</span>;</span><br><span class="line">    db.base(sql,<span class="literal">null</span>,(result)=&gt;&#123;</span><br><span class="line">        res.render(<span class="string">'index'</span>,&#123;<span class="attr">list</span> : result&#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 跳转到添加图书的页面</span></span><br><span class="line">exports.toAddBook = <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.render(<span class="string">'addBook'</span>,&#123;&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 添加图书保存数据</span></span><br><span class="line">exports.addBook = <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 获取表单数据</span></span><br><span class="line">    <span class="keyword">let</span> info = req.body;</span><br><span class="line">    <span class="keyword">let</span> book = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> info)&#123;</span><br><span class="line">        book[key] = info[key];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> sql = <span class="string">'insert into book set ?'</span>;</span><br><span class="line">    db.base(sql,book,(result)=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(result.affectedRows == <span class="number">1</span>)&#123;</span><br><span class="line">            res.redirect(<span class="string">'/'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 跳转编辑图书页面</span></span><br><span class="line">exports.toEditBook = <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> id = req.query.id;</span><br><span class="line">    <span class="keyword">let</span> sql = <span class="string">'select * from book where id=?'</span>;</span><br><span class="line">    <span class="keyword">let</span> data = [id];</span><br><span class="line">    db.base(sql,data,(result)=&gt;&#123;</span><br><span class="line">        res.render(<span class="string">'editBook'</span>,result[<span class="number">0</span>]);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 编辑图书更新数据</span></span><br><span class="line">exports.editBook = <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> info = req.body;</span><br><span class="line">    <span class="keyword">let</span> sql = <span class="string">'update book set name=?,author=?,category=?,description=? where id=?'</span>;</span><br><span class="line">    <span class="keyword">let</span> data = [info.name,info.author,info.category,info.description,info.id];</span><br><span class="line">    db.base(sql,data,(result)=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(result.affectedRows == <span class="number">1</span>)&#123;</span><br><span class="line">            res.redirect(<span class="string">'/'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删除图书信息</span></span><br><span class="line">exports.deleteBook = <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> id = req.query.id;</span><br><span class="line">    <span class="keyword">let</span> sql = <span class="string">'delete from book where id=?'</span>;</span><br><span class="line">    <span class="keyword">let</span> data = [id];</span><br><span class="line">    db.base(sql,data,(result)=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(result.affectedRows == <span class="number">1</span>)&#123;</span><br><span class="line">            res.redirect(<span class="string">'/'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.art --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>图书管理系统<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"/www/style.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>图书管理系统<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/toAddBook"</span>&gt;</span>添加图书<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">cellpadding</span>=<span class="string">"0"</span> <span class="attr">cellspacing</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>编号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>作者<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>分类<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>描述<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                &#123;&#123;each list&#125;&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.id&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.author&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.category&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.description&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/toEditBook?id=&#123;&#123;$value.id&#125;&#125;"</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">a</span>&gt;</span>|<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/deleteBook?id=&#123;&#123;$value.id&#125;&#125;"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                &#123;&#123;/each&#125;&#125;</span><br><span class="line">                <span class="comment">&lt;!-- &lt;tr&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;1&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;西游记&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;吴承恩&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;文学&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;佛教与道教的斗争&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;&lt;a href="#"&gt;修改&lt;/a&gt;|&lt;a href="#"&gt;删除&lt;/a&gt;&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                &lt;/tr&gt;</span></span><br><span class="line"><span class="comment">                &lt;tr&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;1&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;西游记&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;吴承恩&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;文学&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;佛教与道教的斗争&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;&lt;a href="#"&gt;修改&lt;/a&gt;|&lt;a href="#"&gt;删除&lt;/a&gt;&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                &lt;/tr&gt;</span></span><br><span class="line"><span class="comment">                &lt;tr&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;1&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;西游记&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;吴承恩&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;文学&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;佛教与道教的斗争&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                    &lt;td&gt;&lt;a href="#"&gt;修改&lt;/a&gt;|&lt;a href="#"&gt;删除&lt;/a&gt;&lt;/td&gt;</span></span><br><span class="line"><span class="comment">                &lt;/tr&gt; --&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- addBook.art --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>添加图书<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>添加图书<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/addBook"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">        名称：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        作者：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"author"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        分类：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"category"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        描述：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"description"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- editBook.art --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>修改图书<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>修改图书<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/editBook"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123;id&#125;&#125;"</span>&gt;</span></span><br><span class="line">        名称：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123;name&#125;&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        作者：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123;author&#125;&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        分类：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"category"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123;category&#125;&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        描述：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"description"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123;description&#125;&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="后台接口开发"><a href="#后台接口开发" class="headerlink" title="后台接口开发"></a>后台接口开发</h2><ul>
<li>json接口</li>
<li>jsonp接口</li>
<li>restful接口<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    后台接口开发</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">'./db.js'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定api路径 allBooks (json接口)</span></span><br><span class="line"><span class="comment">// app.get('/allBooks',(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//     let sql = 'select * from book';</span></span><br><span class="line"><span class="comment">//     db.base(sql,null,(result)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//         res.json(result);</span></span><br><span class="line"><span class="comment">//     &#125;);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改json回调函数传递参数的key</span></span><br><span class="line">app.set(<span class="string">'jsonp callback name'</span>, <span class="string">'cb'</span>);</span><br><span class="line"><span class="comment">// 指定api路径 allBooks （jsonp接口）</span></span><br><span class="line">app.get(<span class="string">'/allBooks'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> sql = <span class="string">'select * from book'</span>;</span><br><span class="line">    db.base(sql,<span class="literal">null</span>,(result)=&gt;&#123;</span><br><span class="line">        res.jsonp(result);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /*</span></span><br><span class="line"><span class="comment">//     封装操作数据库的通用api db.js</span></span><br><span class="line"><span class="comment">// */</span></span><br><span class="line"><span class="comment">// const mysql = require('mysql');</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// exports.base = (sql,data,callback) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     // 创建数据库连接</span></span><br><span class="line"><span class="comment">//     const connection = mysql.createConnection(&#123;</span></span><br><span class="line"><span class="comment">//         host: 'localhost', // 数据库所在的服务器的域名或者IP地址</span></span><br><span class="line"><span class="comment">//         user: 'root', // 登录数据库的账号</span></span><br><span class="line"><span class="comment">//         password: '', // 登录数据库的密码</span></span><br><span class="line"><span class="comment">//         database: 'book' // 数据库名称</span></span><br><span class="line"><span class="comment">//     &#125;);</span></span><br><span class="line"><span class="comment">//     // 执行连接操作</span></span><br><span class="line"><span class="comment">//     connection.connect();</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">//     // 操作数据库(数据库操作也是异步的)</span></span><br><span class="line"><span class="comment">//     connection.query(sql,data, function(error, results, fields) &#123;</span></span><br><span class="line"><span class="comment">//         if (error) throw error;</span></span><br><span class="line"><span class="comment">//         callback(results);</span></span><br><span class="line"><span class="comment">//     &#125;);</span></span><br><span class="line"><span class="comment">//     // 关闭数据库</span></span><br><span class="line"><span class="comment">//     connection.end();</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    restful api  是从URL的格式来表述的</span></span><br><span class="line"><span class="comment">    get     http://localhost:3000/books</span></span><br><span class="line"><span class="comment">    get     http://localhost:3000/books/book</span></span><br><span class="line"><span class="comment">    post    http://localhost:3000/books/book</span></span><br><span class="line"><span class="comment">    get     http://localhost:3000/books/book/1</span></span><br><span class="line"><span class="comment">    put     http://localhost:3000/books/book</span></span><br><span class="line"><span class="comment">    delete  http://localhost:3000/books/book/2</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    传统的URL风格</span></span><br><span class="line"><span class="comment">    http://localhost:3000/</span></span><br><span class="line"><span class="comment">    http://localhost:3000/toAddBook</span></span><br><span class="line"><span class="comment">    http://localhost:3000/addBook</span></span><br><span class="line"><span class="comment">    http://localhost:3000/toEditBook?id=1</span></span><br><span class="line"><span class="comment">    http://localhost:3000/editBook</span></span><br><span class="line"><span class="comment">    http://localhost:3000/deleteBook?id=2</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">'./db.js'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/books'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> sql = <span class="string">'select * from book'</span>;</span><br><span class="line">    db.base(sql,<span class="literal">null</span>,(result)=&gt;&#123;</span><br><span class="line">        res.json(result);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// http://localhost:3000/books/book/1</span></span><br><span class="line">app.get(<span class="string">'/books/book/:id'</span>,(req,res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> id = req.params.id;</span><br><span class="line">    <span class="keyword">let</span> sql = <span class="string">'select * from book where id=?'</span>;</span><br><span class="line">    <span class="keyword">let</span> data = [id];</span><br><span class="line">    db.base(sql,data,(result)=&gt;&#123;</span><br><span class="line">        res.json(result[<span class="number">0</span>]);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="基于Ajax与后台接口的前端渲染案例"><a href="#基于Ajax与后台接口的前端渲染案例" class="headerlink" title="基于Ajax与后台接口的前端渲染案例"></a>基于Ajax与后台接口的前端渲染案例</h2><ul>
<li>前端渲染与后端渲染分析<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ---index.js</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    实现图书管理系统后台接口</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">'./router.js'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/www'</span>,express.static(<span class="string">'public'</span>));</span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(router);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'running...'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---router.js</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    get     http://localhost:3000/books</span></span><br><span class="line"><span class="comment">    get     http://localhost:3000/books/book</span></span><br><span class="line"><span class="comment">    post    http://localhost:3000/books/book</span></span><br><span class="line"><span class="comment">    get     http://localhost:3000/books/book/1</span></span><br><span class="line"><span class="comment">    put     http://localhost:3000/books/book</span></span><br><span class="line"><span class="comment">    delete  http://localhost:3000/books/book/2</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> service = <span class="built_in">require</span>(<span class="string">'./service.js'</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="comment">// 提供所有的图书信息</span></span><br><span class="line">router.get(<span class="string">'/books'</span>,service.allBooks);</span><br><span class="line"><span class="comment">// 添加图书信息时提交数据</span></span><br><span class="line">router.post(<span class="string">'/books/book'</span>,service.addBook);</span><br><span class="line"><span class="comment">// 编辑图书时根据id查询相应信息</span></span><br><span class="line">router.get(<span class="string">'/books/book/:id'</span>,service.getBookById);</span><br><span class="line"><span class="comment">// 提交编辑的数据</span></span><br><span class="line">router.put(<span class="string">'/books/book'</span>,service.editBook);</span><br><span class="line"><span class="comment">// 删除图书信息</span></span><br><span class="line">router.delete(<span class="string">'/books/book/:id'</span>,service.deleteBook);</span><br><span class="line"><span class="comment">// 查询天气</span></span><br><span class="line">router.get(<span class="string">'/weather/:id'</span>,service.queryWeather);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br><span class="line"></span><br><span class="line"><span class="comment">//---db.js</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    封装操作数据库的通用api</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"></span><br><span class="line">exports.base = <span class="function">(<span class="params">sql,data,callback</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 创建数据库连接</span></span><br><span class="line">    <span class="keyword">const</span> connection = mysql.createConnection(&#123;</span><br><span class="line">        host: <span class="string">'localhost'</span>, <span class="comment">// 数据库所在的服务器的域名或者IP地址</span></span><br><span class="line">        user: <span class="string">'root'</span>, <span class="comment">// 登录数据库的账号</span></span><br><span class="line">        password: <span class="string">''</span>, <span class="comment">// 登录数据库的密码</span></span><br><span class="line">        database: <span class="string">'book'</span> <span class="comment">// 数据库名称</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 执行连接操作</span></span><br><span class="line">    connection.connect();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 操作数据库(数据库操作也是异步的)</span></span><br><span class="line">    connection.query(sql,data, <span class="function"><span class="keyword">function</span>(<span class="params">error, results, fields</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">        callback(results);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 关闭数据库</span></span><br><span class="line">    connection.end();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---service.js</span></span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">'./db.js'</span>);</span><br><span class="line"><span class="keyword">const</span> weather = <span class="built_in">require</span>(<span class="string">'./api.js'</span>);</span><br><span class="line"></span><br><span class="line">exports.allBooks = <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> sql = <span class="string">'select * from book'</span>;</span><br><span class="line">    db.base(sql,<span class="literal">null</span>,(result)=&gt;&#123;</span><br><span class="line">        res.json(result);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">exports.addBook = <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> info = req.body;</span><br><span class="line">    <span class="keyword">let</span> sql = <span class="string">'insert into book set ?'</span>;</span><br><span class="line">    db.base(sql,info,(result)=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(result.affectedRows == <span class="number">1</span>)&#123;</span><br><span class="line">            res.json(&#123;<span class="attr">flag</span> : <span class="number">1</span>&#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.json(&#123;<span class="attr">flag</span> : <span class="number">2</span>&#125;);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">exports.getBookById = <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> id = req.params.id;</span><br><span class="line">    <span class="keyword">let</span> sql = <span class="string">'select * from book where id=?'</span>;</span><br><span class="line">    <span class="keyword">let</span> data = [id];</span><br><span class="line">    db.base(sql,data,(result)=&gt;&#123;</span><br><span class="line">        res.json(result[<span class="number">0</span>]);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">exports.editBook = <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> info = req.body;</span><br><span class="line">    <span class="keyword">let</span> sql = <span class="string">'update book set name=?,author=?,category=?,description=? where id=?'</span>;</span><br><span class="line">    <span class="keyword">let</span> data = [info.name,info.author,info.category,info.description,info.id];</span><br><span class="line">    db.base(sql,data,(result)=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(result.affectedRows == <span class="number">1</span>)&#123;</span><br><span class="line">            res.json(&#123;<span class="attr">flag</span> : <span class="number">1</span>&#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.json(&#123;<span class="attr">flag</span> : <span class="number">2</span>&#125;);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">exports.deleteBook = <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> id = req.params.id;</span><br><span class="line">    <span class="keyword">let</span> sql = <span class="string">'delete from book where id=?'</span>;</span><br><span class="line">    <span class="keyword">let</span> data = [id];</span><br><span class="line">    db.base(sql,data,(result)=&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(result.affectedRows == <span class="number">1</span>)&#123;</span><br><span class="line">            res.json(&#123;<span class="attr">flag</span> : <span class="number">1</span>&#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.json(&#123;<span class="attr">flag</span> : <span class="number">2</span>&#125;);</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">exports.queryWeather = <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> cityCode = req.params.id;</span><br><span class="line">    weather.queryWeather(cityCode,(data)=&gt;&#123;</span><br><span class="line">        res.json(&#123;<span class="attr">info</span> : data.weatherinfo&#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    调用第三方接口-获取天气信息-封装通用的天气查询模块</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"></span><br><span class="line">exports.queryWeather = <span class="function">(<span class="params">cityCode,callback</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> options = &#123;</span><br><span class="line">        protocol : <span class="string">'http:'</span>,</span><br><span class="line">        hostname : <span class="string">'www.weather.com.cn'</span>,</span><br><span class="line">        port : <span class="number">80</span>,</span><br><span class="line">        path : <span class="string">'/data/sk/'</span>+cityCode+<span class="string">'.html'</span>,</span><br><span class="line">        method : <span class="string">'get'</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> req = http.request(options,(res)=&gt;&#123;</span><br><span class="line">        <span class="keyword">let</span> info = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">        res.on(<span class="string">'data'</span>,(chunk)=&gt;&#123;</span><br><span class="line">            info += chunk;</span><br><span class="line">        &#125;);</span><br><span class="line">        res.on(<span class="string">'end'</span>,()=&gt;&#123;</span><br><span class="line">            info = <span class="built_in">JSON</span>.parse(info);</span><br><span class="line">            callback(info);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    req.end();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---index.js</span></span><br><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 初始化数据列表</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">initList</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            type : <span class="string">'get'</span>,</span><br><span class="line">            url : <span class="string">'/books'</span>,</span><br><span class="line">            dataType : <span class="string">'json'</span>,</span><br><span class="line">            success : <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">                <span class="comment">// 渲染数据列表</span></span><br><span class="line">                <span class="keyword">var</span> html = template(<span class="string">'indexTpl'</span>,&#123;<span class="attr">list</span> : data&#125;);</span><br><span class="line">                $(<span class="string">'#dataList'</span>).html(html);</span><br><span class="line">                <span class="comment">// 必须在渲染完成内容之后才可以操作DOM标签</span></span><br><span class="line"></span><br><span class="line">                $(<span class="string">'#dataList'</span>).find(<span class="string">'tr'</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">index,element</span>)</span>&#123;</span><br><span class="line">                    <span class="keyword">var</span> td = $(element).find(<span class="string">'td:eq(5)'</span>);</span><br><span class="line">                    <span class="keyword">var</span> id = $(element).find(<span class="string">'td:eq(0)'</span>).text();</span><br><span class="line">                    <span class="comment">// 绑定编辑图书的单击事件</span></span><br><span class="line">                    td.find(<span class="string">'a:eq(0)'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                        editBook(id);</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="comment">// 绑定删除图书的单击事件</span></span><br><span class="line">                    td.find(<span class="string">'a:eq(1)'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                        deleteBook(id);</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 绑定添加图书信息的单击事件</span></span><br><span class="line">                    addBook();</span><br><span class="line">                    <span class="comment">// 重置表单</span></span><br><span class="line">                    <span class="keyword">var</span> form = $(<span class="string">'#addBookForm'</span>);</span><br><span class="line">                    form.get(<span class="number">0</span>).reset();</span><br><span class="line">                    form.find(<span class="string">'input[type=hidden]'</span>).val(<span class="string">''</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    initList();</span><br><span class="line">    <span class="comment">// 删除图书信息</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">deleteBook</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            type : <span class="string">'delete'</span>,</span><br><span class="line">            url : <span class="string">'/books/book/'</span> + id,</span><br><span class="line">            dataType : <span class="string">'json'</span>,</span><br><span class="line">            success : <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">                <span class="comment">// 删除图书信息之后重新渲染数据列表</span></span><br><span class="line">                <span class="keyword">if</span>(data.flag == <span class="string">'1'</span>)&#123;</span><br><span class="line">                    initList();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 编辑图书信息</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">editBook</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> form = $(<span class="string">'#addBookForm'</span>);</span><br><span class="line">        <span class="comment">// 先根据数据id查询最新的数据</span></span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            type : <span class="string">'get'</span>,</span><br><span class="line">            url : <span class="string">'/books/book/'</span> + id,</span><br><span class="line">            dataType : <span class="string">'json'</span>,</span><br><span class="line">            success : <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">                <span class="comment">// 初始化弹窗</span></span><br><span class="line">                <span class="keyword">var</span> mark = <span class="keyword">new</span> MarkBox(<span class="number">600</span>,<span class="number">400</span>,<span class="string">'编辑图书'</span>,form.get(<span class="number">0</span>));</span><br><span class="line">                mark.init();</span><br><span class="line">                <span class="comment">// 填充表单数据</span></span><br><span class="line">                form.find(<span class="string">'input[name=id]'</span>).val(data.id);</span><br><span class="line">                form.find(<span class="string">'input[name=name]'</span>).val(data.name);</span><br><span class="line">                form.find(<span class="string">'input[name=author]'</span>).val(data.author);</span><br><span class="line">                form.find(<span class="string">'input[name=category]'</span>).val(data.category);</span><br><span class="line">                form.find(<span class="string">'input[name=description]'</span>).val(data.description);</span><br><span class="line">                <span class="comment">// 对表单提交按钮重新绑定单击事件</span></span><br><span class="line">                form.find(<span class="string">'input[type=button]'</span>).unbind(<span class="string">'click'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                    <span class="comment">// 编辑完成数据之后重新提交表单</span></span><br><span class="line">                    $.ajax(&#123;</span><br><span class="line">                        type : <span class="string">'put'</span>,</span><br><span class="line">                        url : <span class="string">'/books/book'</span>,</span><br><span class="line">                        data : form.serialize(),</span><br><span class="line">                        dataType : <span class="string">'json'</span>,</span><br><span class="line">                        success : <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">                            <span class="keyword">if</span>(data.flag == <span class="string">'1'</span>)&#123;</span><br><span class="line">                                <span class="comment">// 隐藏弹窗</span></span><br><span class="line">                                mark.close();</span><br><span class="line">                                <span class="comment">// 重新渲染数据列表</span></span><br><span class="line">                                initList();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 添加图书信息</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">addBook</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $(<span class="string">'#addBookId'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> form = $(<span class="string">'#addBookForm'</span>);</span><br><span class="line">            <span class="comment">// 实例化弹窗对象</span></span><br><span class="line">            <span class="keyword">var</span> mark = <span class="keyword">new</span> MarkBox(<span class="number">600</span>,<span class="number">400</span>,<span class="string">'添加图书'</span>,form.get(<span class="number">0</span>));</span><br><span class="line">            mark.init();</span><br><span class="line">            form.find(<span class="string">'input[type=button]'</span>).unbind(<span class="string">'click'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    type : <span class="string">'post'</span>,</span><br><span class="line">                    url : <span class="string">'/books/book'</span>,</span><br><span class="line">                    data : form.serialize(),</span><br><span class="line">                    dataType : <span class="string">'json'</span>,</span><br><span class="line">                    success : <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">                        <span class="keyword">if</span>(data.flag == <span class="string">'1'</span>)&#123;</span><br><span class="line">                            <span class="comment">// 关闭弹窗</span></span><br><span class="line">                            mark.close();</span><br><span class="line">                            <span class="comment">// 添加图书成功之后重新渲染数据列表</span></span><br><span class="line">                            initList();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 查询天气</span></span><br><span class="line">    $(<span class="string">'#weather'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> cityCode = $(<span class="string">'select option:selected'</span>).val();</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            type : <span class="string">'get'</span>,</span><br><span class="line">            url : <span class="string">'/weather/'</span> + cityCode,</span><br><span class="line">            dataType : <span class="string">'json'</span>,</span><br><span class="line">            success : <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">var</span> html = template(<span class="string">'weatherTpl'</span>,data.info);</span><br><span class="line">                <span class="keyword">var</span> mark = <span class="keyword">new</span> MarkBox(<span class="number">600</span>,<span class="number">400</span>,<span class="string">'天气信息'</span>,$(html).get(<span class="number">0</span>));</span><br><span class="line">                mark.init();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>图书管理系统<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"/www/css/style.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/www/js/jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/www/js/template-web.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/www/js/dialog.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/www/js/index.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/template"</span> <span class="attr">id</span>=<span class="string">"indexTpl"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        &#123;&#123;each list&#125;&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.id&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.author&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.category&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;$value.description&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line"><span class="javascript">            &lt;td&gt;<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span>|<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span></span><br><span class="line"><span class="undefined">        &#123;&#123;/each&#125;&#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/template"</span> <span class="attr">id</span>=<span class="string">"weatherTpl"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>城市：&#123;&#123;city&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>风向：&#123;&#123;WD&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>级别：&#123;&#123;WS&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>温度：&#123;&#123;temp&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>时间：&#123;&#123;time&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>图书管理系统<span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"addBookId"</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span>&gt;</span>添加图书<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"101010100"</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"101020100"</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"101280101"</span>&gt;</span>广州<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"101280601"</span>&gt;</span>深圳<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"查询"</span> <span class="attr">id</span>=<span class="string">"weather"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">cellpadding</span>=<span class="string">"0"</span> <span class="attr">cellspacing</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>编号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>作者<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>分类<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>描述<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">id</span>=<span class="string">"dataList"</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">            <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"form"</span> <span class="attr">id</span>=<span class="string">"addBookForm"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">        名称：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        作者：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"author"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        分类：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"category"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        描述：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"description"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="从服务器主动发送请求"><a href="#从服务器主动发送请求" class="headerlink" title="从服务器主动发送请求"></a>从服务器主动发送请求</h2><ul>
<li>基于核心模块主动发送请求<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    从服务器主动发送请求</span></span><br><span class="line"><span class="comment">    http.request(options[, callback])</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> options = &#123;</span><br><span class="line">    hostname : <span class="string">'www.baidu.com'</span>,</span><br><span class="line">    port : <span class="number">80</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> req = http.request(options,(res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> info = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    res.on(<span class="string">'data'</span>,(chunk)=&gt;&#123;</span><br><span class="line">        info += chunk;</span><br><span class="line">    &#125;);</span><br><span class="line">    res.on(<span class="string">'end'</span>,()=&gt;&#123;</span><br><span class="line">        fs.writeFile(path.join(__dirname,<span class="string">'baidu.html'</span>),info,(err)=&gt;&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'已经获取到百度主页的内容'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">req.end();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---01.js</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    从服务器主动发送请求调用接口-查询数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> options = &#123;</span><br><span class="line">    protocol : <span class="string">'http:'</span>,</span><br><span class="line">    hostname : <span class="string">'localhost'</span>,</span><br><span class="line">    port : <span class="number">3000</span>,</span><br><span class="line">    path : <span class="string">'/books'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> req = http.request(options,(res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> info = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    res.on(<span class="string">'data'</span>,(chunk)=&gt;&#123;</span><br><span class="line">        info += chunk;</span><br><span class="line">    &#125;);</span><br><span class="line">    res.on(<span class="string">'end'</span>,()=&gt;&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(info);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">req.end();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---02.js</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    从服务器主动发送请求调用接口-添加数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> options = &#123;</span><br><span class="line">    protocol : <span class="string">'http:'</span>,</span><br><span class="line">    hostname : <span class="string">'localhost'</span>,</span><br><span class="line">    port : <span class="number">3000</span>,</span><br><span class="line">    path : <span class="string">'/books/book'</span>,</span><br><span class="line">    method : <span class="string">'post'</span>,</span><br><span class="line">    headers : &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> req = http.request(options,(res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> info = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    res.on(<span class="string">'data'</span>,(chunk)=&gt;&#123;</span><br><span class="line">        info += chunk;</span><br><span class="line">    &#125;);</span><br><span class="line">    res.on(<span class="string">'end'</span>,()=&gt;&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(info);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> data = querystring.stringify(&#123;</span><br><span class="line">    name : <span class="string">'adafa'</span>,</span><br><span class="line">    author : <span class="string">'asdfa'</span>,</span><br><span class="line">    category : <span class="string">'afdasf'</span>,</span><br><span class="line">    description : <span class="string">'adsfa'</span></span><br><span class="line">&#125;);</span><br><span class="line">req.write(data);</span><br><span class="line">req.end();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---03.js</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    从服务器主动发送请求调用接口-根据id去查询数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> options = &#123;</span><br><span class="line">    protocol : <span class="string">'http:'</span>,</span><br><span class="line">    hostname : <span class="string">'localhost'</span>,</span><br><span class="line">    port : <span class="number">3000</span>,</span><br><span class="line">    path : <span class="string">'/books/book/2'</span>,</span><br><span class="line">    method : <span class="string">'get'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> req = http.request(options,(res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> info = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    res.on(<span class="string">'data'</span>,(chunk)=&gt;&#123;</span><br><span class="line">        info += chunk;</span><br><span class="line">    &#125;);</span><br><span class="line">    res.on(<span class="string">'end'</span>,()=&gt;&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(info);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">req.end();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---04.js</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    从服务器主动发送请求调用接口-编辑数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> options = &#123;</span><br><span class="line">    protocol : <span class="string">'http:'</span>,</span><br><span class="line">    hostname : <span class="string">'localhost'</span>,</span><br><span class="line">    port : <span class="number">3000</span>,</span><br><span class="line">    path : <span class="string">'/books/book'</span>,</span><br><span class="line">    method : <span class="string">'put'</span>,</span><br><span class="line">    headers : &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> req = http.request(options,(res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> info = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    res.on(<span class="string">'data'</span>,(chunk)=&gt;&#123;</span><br><span class="line">        info += chunk;</span><br><span class="line">    &#125;);</span><br><span class="line">    res.on(<span class="string">'end'</span>,()=&gt;&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(info);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> data = querystring.stringify(&#123;</span><br><span class="line">    id : <span class="number">34</span>,</span><br><span class="line">    name : <span class="string">'ddddddddd'</span>,</span><br><span class="line">    author : <span class="string">'sssssssss'</span>,</span><br><span class="line">    category : <span class="string">'eeeeeeeee'</span>,</span><br><span class="line">    description : <span class="string">'gggggggg'</span></span><br><span class="line">&#125;);</span><br><span class="line">req.write(data);</span><br><span class="line">req.end();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---05.js</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    从服务器主动发送请求调用接口-删除数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> options = &#123;</span><br><span class="line">    protocol : <span class="string">'http:'</span>,</span><br><span class="line">    hostname : <span class="string">'localhost'</span>,</span><br><span class="line">    port : <span class="number">3000</span>,</span><br><span class="line">    path : <span class="string">'/books/book/34'</span>,</span><br><span class="line">    method : <span class="string">'delete'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> req = http.request(options,(res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> info = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    res.on(<span class="string">'data'</span>,(chunk)=&gt;&#123;</span><br><span class="line">        info += chunk;</span><br><span class="line">    &#125;);</span><br><span class="line">    res.on(<span class="string">'end'</span>,()=&gt;&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(info);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">req.end();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="调用第三方接口"><a href="#调用第三方接口" class="headerlink" title="调用第三方接口"></a>调用第三方接口</h2><ul>
<li>针对第三方接口进行二次封装</li>
<li>扩展天气查询功能</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    调用第三方接口-获取天气信息</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cityCode = <span class="string">'101010300'</span>;</span><br><span class="line"><span class="keyword">let</span> options = &#123;</span><br><span class="line">    protocol : <span class="string">'http:'</span>,</span><br><span class="line">    hostname : <span class="string">'www.weather.com.cn'</span>,</span><br><span class="line">    port : <span class="number">80</span>,</span><br><span class="line">    path : <span class="string">'/data/sk/'</span>+cityCode+<span class="string">'.html'</span>,</span><br><span class="line">    method : <span class="string">'get'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> req = http.request(options,(res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> info = <span class="string">''</span>;</span><br><span class="line">    res.on(<span class="string">'data'</span>,(chunk)=&gt;&#123;</span><br><span class="line">        info += chunk;</span><br><span class="line">    &#125;);</span><br><span class="line">    res.on(<span class="string">'end'</span>,()=&gt;&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(info);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">req.end();</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- ---</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    调用第三方接口-获取天气信息-封装通用的天气查询模块</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"></span><br><span class="line">exports.queryWeather = <span class="function">(<span class="params">cityCode,callback</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> options = &#123;</span><br><span class="line">        protocol : <span class="string">'http:'</span>,</span><br><span class="line">        hostname : <span class="string">'www.weather.com.cn'</span>,</span><br><span class="line">        port : <span class="number">80</span>,</span><br><span class="line">        path : <span class="string">'/data/sk/'</span>+cityCode+<span class="string">'.html'</span>,</span><br><span class="line">        method : <span class="string">'get'</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> req = http.request(options,(res)=&gt;&#123;</span><br><span class="line">        <span class="keyword">let</span> info = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">        res.on(<span class="string">'data'</span>,(chunk)=&gt;&#123;</span><br><span class="line">            info += chunk;</span><br><span class="line">        &#125;);</span><br><span class="line">        res.on(<span class="string">'end'</span>,()=&gt;&#123;</span><br><span class="line">            info = <span class="built_in">JSON</span>.parse(info);</span><br><span class="line">            callback(info);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    req.end();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ---</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    测试天气查询模块</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> weather = <span class="built_in">require</span>(<span class="string">'./weather.js'</span>);<span class="comment">/**/</span></span><br><span class="line"></span><br><span class="line">weather.queryWeather(<span class="string">'101020100'</span>,(data)=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data.weatherinfo.WD);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    通过第三方包superagent发送服务器请求</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">'superagent'</span>);</span><br><span class="line"><span class="comment">// request.get('http://localhost:3000/books')</span></span><br><span class="line"><span class="comment">//        .end((err,res) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//            // console.log(res.body);//有数据格式</span></span><br><span class="line"><span class="comment">//            console.log(res.text);//字符串</span></span><br><span class="line"><span class="comment">//        &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// request.post('http://localhost:3000/books/book')</span></span><br><span class="line"><span class="comment">//        .set('Content-Type', 'application/x-www-form-urlencoded')</span></span><br><span class="line"><span class="comment">//        .send(&#123;name:'abadf',author:'adfads',category:'adsfads',description:'asdfads'&#125;)</span></span><br><span class="line"><span class="comment">//        .end((err,res) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//            console.log(res.body);//有数据格式</span></span><br><span class="line"><span class="comment">//        &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// request.get('http://localhost:3000/books/book/2')</span></span><br><span class="line"><span class="comment">//        .end((err,res) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//            console.log(res.body);//有数据格式</span></span><br><span class="line"><span class="comment">//        &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// request.put('http://localhost:3000/books/book')</span></span><br><span class="line"><span class="comment">//        .set('Content-Type', 'application/x-www-form-urlencoded')</span></span><br><span class="line"><span class="comment">//        .send(&#123;id:'39',name:'dddd',author:'fff',category:'ccc',description:'ggg'&#125;)</span></span><br><span class="line"><span class="comment">//        .end((err,res) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//            console.log(res.body);//有数据格式</span></span><br><span class="line"><span class="comment">//        &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// request.delete('http://localhost:3000/books/book/39')</span></span><br><span class="line"><span class="comment">//        .end((err,res) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//            console.log(res.body);//有数据格式</span></span><br><span class="line"><span class="comment">//        &#125;);</span></span><br><span class="line"></span><br><span class="line">request.get(<span class="string">'http://www.weather.com.cn/data/sk/101010100.html'</span>)</span><br><span class="line">       .end(<span class="function">(<span class="params">err,res</span>) =&gt;</span> &#123;</span><br><span class="line">           <span class="comment">// console.log(res.body);//有数据格式</span></span><br><span class="line">           <span class="built_in">console</span>.log(res.text);</span><br><span class="line">       &#125;);</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="../../../../tags/NodeJS/" rel="tag"># NodeJS</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="../Node12/" rel="next" title="Node学习(12)--进程及打包">
                <i class="fa fa-chevron-left"></i> Node学习(12)--进程及打包
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="../webscoket/" rel="prev" title="学习webscoket">
                学习webscoket <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Majun</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="../../../../archives">
              
                  <span class="site-state-item-count">88</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="../../../../categories/index.html">
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="../../../../tags/index.html">
                  <span class="site-state-item-count">52</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#补充"><span class="nav-number">1.</span> <span class="nav-text">补充</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#全局对象global"><span class="nav-number">2.</span> <span class="nav-text">全局对象global</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#buffer"><span class="nav-number">3.</span> <span class="nav-text">buffer</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#核心模块API"><span class="nav-number"></span> <span class="nav-text">核心模块API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#路径操作"><span class="nav-number">1.</span> <span class="nav-text">路径操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#文件操作"><span class="nav-number">2.</span> <span class="nav-text">文件操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Node-js实现静态网站功能"><span class="nav-number"></span> <span class="nav-text">Node.js实现静态网站功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参数传递与获取"><span class="nav-number"></span> <span class="nav-text">参数传递与获取</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#动态网站开发"><span class="nav-number"></span> <span class="nav-text">动态网站开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模板引擎"><span class="nav-number"></span> <span class="nav-text">模板引擎</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Express基本使用"><span class="nav-number"></span> <span class="nav-text">Express基本使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Express基本使用-1"><span class="nav-number"></span> <span class="nav-text">Express基本使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Express图书管理案例"><span class="nav-number"></span> <span class="nav-text">Express图书管理案例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Node-js操作数据库"><span class="nav-number"></span> <span class="nav-text">Node.js操作数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mysql第三方包基本使用"><span class="nav-number"></span> <span class="nav-text">mysql第三方包基本使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基于数据库实现登录功能"><span class="nav-number"></span> <span class="nav-text">基于数据库实现登录功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#图书管理系统整合数据库"><span class="nav-number"></span> <span class="nav-text">图书管理系统整合数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#后台接口开发"><span class="nav-number"></span> <span class="nav-text">后台接口开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基于Ajax与后台接口的前端渲染案例"><span class="nav-number"></span> <span class="nav-text">基于Ajax与后台接口的前端渲染案例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#从服务器主动发送请求"><span class="nav-number"></span> <span class="nav-text">从服务器主动发送请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#调用第三方接口"><span class="nav-number"></span> <span class="nav-text">调用第三方接口</span></a></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Majun</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  







  
  
    <script type="text/javascript" src="../../../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="../../../../lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="../../../../lib/three/canvas_lines.min.js"></script>
  


  


  <script type="text/javascript" src="../../../../js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="../../../../js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="../../../../js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="../../../../js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="../../../../js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  









<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>



  





  

  

  

  
  

  

  

  

</body>
</html>
